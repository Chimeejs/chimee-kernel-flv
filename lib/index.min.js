!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.chimeeKernelFlv=t()}(this,function(){"use strict";function e(e){return e&&e.__esModule?e.default:e}function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function i(e){return void 0===e||null===e}function n(e){return Array.isArray(e)}function r(e){return"function"==typeof e}function a(e){return Object(e)===e&&"[object Object]"===String(e)&&!r(e)&&!n(e)}function o(e){return"number"==typeof e}function s(e){return"string"==typeof e||e instanceof String}function u(e){return"boolean"==typeof e}function l(e){return i(e)||u(e)||s(e)||o(e)}function c(e,t){if(!s(e))throw new TypeError("Log's method only acccept string as argument, but not "+e+" in "+(void 0===e?"undefined":hi(e)));return s(t)?"["+(e=Ei.FORCE_GLOBAL_TAG?Ei.GLOBAL_TAG:e||Ei.GLOBAL_TAG)+"] > "+t:"["+Ei.GLOBAL_TAG+"] > "+e}function h(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t.length<2)throw new Error("deepAssign accept two and more argument");for(var n=t.length-1;n>-1;n--)if(l(t[n]))throw new TypeError("deepAssign only accept non primitive type");var r=t.shift();return t.forEach(function(e){return Zi(e,r)}),r}function f(e,t,i,n){var r=void 0,a=void 0,o=void 0,s=null,u=0;i||(i={});var l=function(){u=!1===i.leading?0:new Date-0,s=null,o=e.apply(r,a),s||(r=a=null)};return t=t||0,function(){var c=new Date;u||!1!==i.leading||(u=c);var h=t-(c-u);return r=n||this,a=arguments,h<=0||h>t?(s&&(clearTimeout(s),s=null),u=c,o=e.apply(r,a),s||(r=a=null)):s||!1===i.trailing||(s=setTimeout(l,h)),o}}function d(e,t){var i=e.__evt_id;i||(Object.defineProperty(e,"__evt_id",{writable:!0,enumerable:!1,configurable:!0}),i=e.__evt_id=++Kn.count);var n=i+"_"+t,r=Kn[n];return r||(r=Kn[n]=[]),r}function p(e,t,i){var n=Wn(null);n.type=t,n.target=e,i&&Gn(n,a(i)?i:{data:i}),d(e,t).forEach(function(t){(t[1]||t[0]).apply(e,[n])})}function m(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];r(n)&&!a&&(a=n,n=void 0);var o=[i,void 0,n];n&&!a&&(a=function(){g(e,t,i,n);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];i.apply(e,a)}),a&&(o[1]=a),d(e,t).push(o)}function g(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=d(e,t);if(i||n){var a=-1,o=void 0;return r.find(function(e,t){if((!i||e[0]===i)&&(!n||e[2]))return a=t,o=e[1],!0}),-1!==a&&r.splice(a,1),o}r.length=0}function y(e,t){var i=e.__evt_id;i||(Object.defineProperty(e,"__evt_id",{writable:!0,enumerable:!1,configurable:!0}),i=e.__evt_id=++Zn.count);var n=i+"_"+t,r=Zn[n];return r||(r=Zn[n]=[]),r}function _(e,t,i){var n=Wn(null);n.type=t,n.target=e,i&&Gn(n,a(i)?i:{data:i}),y(e,t).forEach(function(t){(t[1]||t[0]).apply(e,[n])})}function b(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];r(n)&&!a&&(a=n,n=void 0);var o=[i,void 0,n];n&&!a&&(a=function(){w(e,t,i,n);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];i.apply(e,a)}),a&&(o[1]=a),y(e,t).push(o)}function w(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=y(e,t);if(i||n){var a=-1,o=void 0;return r.find(function(e,t){if((!i||e[0]===i)&&(!n||e[2]))return a=t,o=e[1],!0}),-1!==a&&r.splice(a,1),o}r.length=0}function k(e){return Xi(e)}function S(e,t){return e.getAttribute(t)}function x(e,t,i){void 0===i?e.removeAttribute(t):e.setAttribute(t,i)}function A(e,t){if(t&&(t=t.trim())){var i=t.split(/\s+/);if(e.classList)i.forEach(function(t){return e.classList.add(t)});else{var n=" "+(e.className||"")+" ";i.forEach(function(e){-1===n.indexOf(" "+e+" ")&&(n+=" "+e)}),e.className=n.trim()}}}function E(e,t){if(t&&(t=t.trim())){var i=t.split(/\s+/);if(e.classList)i.forEach(function(t){return e.classList.remove(t)});else{var n=" "+e.className+" ";i.forEach(function(e){for(var t=" "+e+" ";-1!==n.indexOf(t);)n=n.replace(t," ")}),e.className=n.trim()}}}function T(e,t){return new RegExp("(?:^|\\s)"+t+"(?=\\s|$)").test(e.className)}function B(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(n){var a=w(e,t+"_once",i);a&&(i=a)}e.removeEventListener(t,i,r)}function L(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(n){var a=i;b(e,t+"_once",a,i=function(){for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];a.apply(this,s),B(e,t,i,n,r)})}e.addEventListener(t,i,r)}function C(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(i){var r=U(i.target||i.srcElement,e,!0),a=R(t,e,!0).find(function(e){return r.find(function(t){return e===t})});a&&n.apply(a,arguments)};b(e,i+"_delegate_"+t,n,a),e.addEventListener(i,a,r)}function O(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=w(e,i+"_delegate_"+t,n);a&&e.removeEventListener(i,a,r)}function D(e,t){return(e.currentStyle||document.defaultView.getComputedStyle(e,null))[t]||e.style[t]}function M(e,t,i){if(a(t))for(var n in t)M(e,n,t[n]);else e.style[t]=i}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,i=arguments[2],n=t.querySelectorAll(e);return i?Xi(n):n}function I(e){e.parentNode.removeChild(e)}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments[2],n=arguments[3],r=[];for(i&&r.push(e);e&&e.parentNode!==t;)(e=e.parentNode)&&r.push(e);return n&&r.push(t),r}function P(e,t){return e.constructor===$n?e:new $n(e,t)}function j(e){for(var t=[],i=e,n=0,r=e.length;n<r;)if(i[n]<128)t.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(N(i,n,1)){var a=(31&i[n])<<6|63&i[n+1];if(a>=128){t.push(String.fromCharCode(65535&a)),n+=2;continue}}}else if(i[n]<240){if(N(i,n,2)){var o=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),n+=3;continue}}}else if(i[n]<248&&N(i,n,3)){var s=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3];if(s>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}function N(e,t,i){var n=e;if(t+i<n.length){for(;i--;)if(128!=(192&n[++t]))return!1;return!0}return!1}var F="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},V=e(t(function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}})),z=t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),G=t(function(e){var t=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=t)}),q=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},H=function(e,t,i){if(q(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)}}return function(){return e.apply(t,arguments)}},W=function(e){return"object"==typeof e?null!==e:"function"==typeof e},K=function(e){if(!W(e))throw TypeError(e+" is not an object!");return e},X=function(e){try{return!!e()}catch(e){return!0}},Z=!X(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Y=z.document,J=W(Y)&&W(Y.createElement),Q=function(e){return J?Y.createElement(e):{}},$=!Z&&!X(function(){return 7!=Object.defineProperty(Q("div"),"a",{get:function(){return 7}}).a}),ee=function(e,t){if(!W(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!W(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!W(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!W(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")},te=Object.defineProperty,ie={f:Z?Object.defineProperty:function(e,t,i){if(K(e),t=ee(t,!0),K(i),$)try{return te(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},ne=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},re=Z?function(e,t,i){return ie.f(e,t,ne(1,i))}:function(e,t,i){return e[t]=i,e},ae=function(e,t,i){var n,r,a,o=e&ae.F,s=e&ae.G,u=e&ae.S,l=e&ae.P,c=e&ae.B,h=e&ae.W,f=s?G:G[t]||(G[t]={}),d=f.prototype,v=s?z:u?z[t]:(z[t]||{}).prototype;s&&(i=t);for(n in i)(r=!o&&v&&void 0!==v[n])&&n in f||(a=r?v[n]:i[n],f[n]=s&&"function"!=typeof v[n]?i[n]:c&&r?H(a,z):h&&v[n]==a?function(e){var t=function(t,i,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(a):l&&"function"==typeof a?H(Function.call,a):a,l&&((f.virtual||(f.virtual={}))[n]=a,e&ae.R&&d&&!d[n]&&re(d,n,a)))};ae.F=1,ae.G=2,ae.S=4,ae.P=8,ae.B=16,ae.W=32,ae.U=64,ae.R=128;var oe=ae;oe(oe.S+oe.F*!Z,"Object",{defineProperty:ie.f});var se=G.Object,ue=function(e,t,i){return se.defineProperty(e,t,i)},le=t(function(e){e.exports={default:ue,__esModule:!0}}),ce=e(t(function(e,t){t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(le);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()})),he=Math.ceil,fe=Math.floor,de=function(e){return isNaN(e=+e)?0:(e>0?fe:he)(e)},ve=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},pe=re,me={}.hasOwnProperty,ge=function(e,t){return me.call(e,t)},ye={},_e={}.toString,be=function(e){return _e.call(e).slice(8,-1)},we=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==be(e)?e.split(""):Object(e)},ke=function(e){return we(ve(e))},Se=Math.min,xe=function(e){return e>0?Se(de(e),9007199254740991):0},Ae=Math.max,Ee=Math.min,Te=function(e,t){return(e=de(e))<0?Ae(e+t,0):Ee(e,t)},Be=z["__core-js_shared__"]||(z["__core-js_shared__"]={}),Le=function(e){return Be[e]||(Be[e]={})},Ce=0,Oe=Math.random(),De=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++Ce+Oe).toString(36))},Me=Le("keys"),Re=function(e){return Me[e]||(Me[e]=De(e))},Ie=function(e){return function(t,i,n){var r,a=ke(t),o=xe(a.length),s=Te(n,o);if(e&&i!=i){for(;o>s;)if((r=a[s++])!=r)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===i)return e||s||0;return!e&&-1}}(!1),Ue=Re("IE_PROTO"),Pe=function(e,t){var i,n=ke(e),r=0,a=[];for(i in n)i!=Ue&&ge(n,i)&&a.push(i);for(;t.length>r;)ge(n,i=t[r++])&&(~Ie(a,i)||a.push(i));return a},je="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Ne=Object.keys||function(e){return Pe(e,je)},Fe=Z?Object.defineProperties:function(e,t){K(e);for(var i,n=Ne(t),r=n.length,a=0;r>a;)ie.f(e,i=n[a++],t[i]);return e},Ve=z.document&&document.documentElement,ze=Re("IE_PROTO"),Ge=function(){},qe=function(){var e,t=Q("iframe"),i=je.length;for(t.style.display="none",Ve.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),qe=e.F;i--;)delete qe.prototype[je[i]];return qe()},He=Object.create||function(e,t){var i;return null!==e?(Ge.prototype=K(e),i=new Ge,Ge.prototype=null,i[ze]=e):i=qe(),void 0===t?i:Fe(i,t)},We=t(function(e){var t=Le("wks"),i=z.Symbol,n="function"==typeof i;(e.exports=function(e){return t[e]||(t[e]=n&&i[e]||(n?i:De)("Symbol."+e))}).store=t}),Ke=ie.f,Xe=We("toStringTag"),Ze=function(e,t,i){e&&!ge(e=i?e:e.prototype,Xe)&&Ke(e,Xe,{configurable:!0,value:t})},Ye={};re(Ye,We("iterator"),function(){return this});var Je=function(e,t,i){e.prototype=He(Ye,{next:ne(1,i)}),Ze(e,t+" Iterator")},Qe=function(e){return Object(ve(e))},$e=Re("IE_PROTO"),et=Object.prototype,tt=Object.getPrototypeOf||function(e){return e=Qe(e),ge(e,$e)?e[$e]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?et:null},it=We("iterator"),nt=!([].keys&&"next"in[].keys()),rt=function(){return this},at=function(e,t,i,n,r,a,o){Je(i,t,n);var s,u,l,c=function(e){if(!nt&&e in v)return v[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},h=t+" Iterator",f="values"==r,d=!1,v=e.prototype,p=v[it]||v["@@iterator"]||r&&v[r],m=p||c(r),g=r?f?c("entries"):m:void 0,y="Array"==t?v.entries||p:p;if(y&&(l=tt(y.call(new e)))!==Object.prototype&&Ze(l,h,!0),f&&p&&"values"!==p.name&&(d=!0,m=function(){return p.call(this)}),o&&(nt||d||!v[it])&&re(v,it,m),ye[t]=m,ye[h]=rt,r)if(s={values:f?m:c("values"),keys:a?m:c("keys"),entries:g},o)for(u in s)u in v||pe(v,u,s[u]);else oe(oe.P+oe.F*(nt||d),t,s);return s},ot=function(e){return function(t,i){var n,r,a=String(ve(t)),o=de(i),s=a.length;return o<0||o>=s?e?"":void 0:(n=a.charCodeAt(o))<55296||n>56319||o+1===s||(r=a.charCodeAt(o+1))<56320||r>57343?e?a.charAt(o):n:e?a.slice(o,o+2):r-56320+(n-55296<<10)+65536}}(!0);at(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=ot(t,i),this._i+=e.length,{value:e,done:!1})});var st=function(){},ut=function(e,t){return{value:t,done:!!e}};at(Array,"Array",function(e,t){this._t=ke(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,ut(1)):"keys"==t?ut(0,i):"values"==t?ut(0,e[i]):ut(0,[i,e[i]])},"values");ye.Arguments=ye.Array,st(),st(),st();for(var lt=We("toStringTag"),ct=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],ht=0;ht<5;ht++){var ft=ct[ht],dt=z[ft],vt=dt&&dt.prototype;vt&&!vt[lt]&&re(vt,lt,ft),ye[ft]=ye.Array}var pt={f:We},mt=pt.f("iterator"),gt=t(function(e){e.exports={default:mt,__esModule:!0}}),yt=t(function(e){var t=De("meta"),i=ie.f,n=0,r=Object.isExtensible||function(){return!0},a=!X(function(){return r(Object.preventExtensions({}))}),o=function(e){i(e,t,{value:{i:"O"+ ++n,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,i){if(!W(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ge(e,t)){if(!r(e))return"F";if(!i)return"E";o(e)}return e[t].i},getWeak:function(e,i){if(!ge(e,t)){if(!r(e))return!0;if(!i)return!1;o(e)}return e[t].w},onFreeze:function(e){return a&&s.NEED&&r(e)&&!ge(e,t)&&o(e),e}}}),_t=ie.f,bt=function(e){var t=G.Symbol||(G.Symbol={});"_"==e.charAt(0)||e in t||_t(t,e,{value:pt.f(e)})},wt=function(e,t){for(var i,n=ke(e),r=Ne(n),a=r.length,o=0;a>o;)if(n[i=r[o++]]===t)return i},kt={f:Object.getOwnPropertySymbols},St={f:{}.propertyIsEnumerable},xt=function(e){var t=Ne(e),i=kt.f;if(i)for(var n,r=i(e),a=St.f,o=0;r.length>o;)a.call(e,n=r[o++])&&t.push(n);return t},At=Array.isArray||function(e){return"Array"==be(e)},Et=je.concat("length","prototype"),Tt={f:Object.getOwnPropertyNames||function(e){return Pe(e,Et)}},Bt=Tt.f,Lt={}.toString,Ct="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ot=function(e){try{return Bt(e)}catch(e){return Ct.slice()}},Dt={f:function(e){return Ct&&"[object Window]"==Lt.call(e)?Ot(e):Bt(ke(e))}},Mt=Object.getOwnPropertyDescriptor,Rt={f:Z?Mt:function(e,t){if(e=ke(e),t=ee(t,!0),$)try{return Mt(e,t)}catch(e){}if(ge(e,t))return ne(!St.f.call(e,t),e[t])}},It=yt.KEY,Ut=Rt.f,Pt=ie.f,jt=Dt.f,Nt=z.Symbol,Ft=z.JSON,Vt=Ft&&Ft.stringify,zt=We("_hidden"),Gt=We("toPrimitive"),qt={}.propertyIsEnumerable,Ht=Le("symbol-registry"),Wt=Le("symbols"),Kt=Le("op-symbols"),Xt=Object.prototype,Zt="function"==typeof Nt,Yt=z.QObject,Jt=!Yt||!Yt.prototype||!Yt.prototype.findChild,Qt=Z&&X(function(){return 7!=He(Pt({},"a",{get:function(){return Pt(this,"a",{value:7}).a}})).a})?function(e,t,i){var n=Ut(Xt,t);n&&delete Xt[t],Pt(e,t,i),n&&e!==Xt&&Pt(Xt,t,n)}:Pt,$t=function(e){var t=Wt[e]=He(Nt.prototype);return t._k=e,t},ei=Zt&&"symbol"==typeof Nt.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof Nt},ti=function(e,t,i){return e===Xt&&ti(Kt,t,i),K(e),t=ee(t,!0),K(i),ge(Wt,t)?(i.enumerable?(ge(e,zt)&&e[zt][t]&&(e[zt][t]=!1),i=He(i,{enumerable:ne(0,!1)})):(ge(e,zt)||Pt(e,zt,ne(1,{})),e[zt][t]=!0),Qt(e,t,i)):Pt(e,t,i)},ii=function(e,t){K(e);for(var i,n=xt(t=ke(t)),r=0,a=n.length;a>r;)ti(e,i=n[r++],t[i]);return e},ni=function(e){var t=qt.call(this,e=ee(e,!0));return!(this===Xt&&ge(Wt,e)&&!ge(Kt,e))&&(!(t||!ge(this,e)||!ge(Wt,e)||ge(this,zt)&&this[zt][e])||t)},ri=function(e,t){if(e=ke(e),t=ee(t,!0),e!==Xt||!ge(Wt,t)||ge(Kt,t)){var i=Ut(e,t);return!i||!ge(Wt,t)||ge(e,zt)&&e[zt][t]||(i.enumerable=!0),i}},ai=function(e){for(var t,i=jt(ke(e)),n=[],r=0;i.length>r;)ge(Wt,t=i[r++])||t==zt||t==It||n.push(t);return n},oi=function(e){for(var t,i=e===Xt,n=jt(i?Kt:ke(e)),r=[],a=0;n.length>a;)!ge(Wt,t=n[a++])||i&&!ge(Xt,t)||r.push(Wt[t]);return r};Zt||(pe((Nt=function(){if(this instanceof Nt)throw TypeError("Symbol is not a constructor!");var e=De(arguments.length>0?arguments[0]:void 0),t=function(i){this===Xt&&t.call(Kt,i),ge(this,zt)&&ge(this[zt],e)&&(this[zt][e]=!1),Qt(this,e,ne(1,i))};return Z&&Jt&&Qt(Xt,e,{configurable:!0,set:t}),$t(e)}).prototype,"toString",function(){return this._k}),Rt.f=ri,ie.f=ti,Tt.f=Dt.f=ai,St.f=ni,kt.f=oi,pt.f=function(e){return $t(We(e))}),oe(oe.G+oe.W+oe.F*!Zt,{Symbol:Nt});for(var si="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ui=0;si.length>ui;)We(si[ui++]);for(var si=Ne(We.store),ui=0;si.length>ui;)bt(si[ui++]);oe(oe.S+oe.F*!Zt,"Symbol",{for:function(e){return ge(Ht,e+="")?Ht[e]:Ht[e]=Nt(e)},keyFor:function(e){if(ei(e))return wt(Ht,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){Jt=!0},useSimple:function(){Jt=!1}}),oe(oe.S+oe.F*!Zt,"Object",{create:function(e,t){return void 0===t?He(e):ii(He(e),t)},defineProperty:ti,defineProperties:ii,getOwnPropertyDescriptor:ri,getOwnPropertyNames:ai,getOwnPropertySymbols:oi}),Ft&&oe(oe.S+oe.F*(!Zt||X(function(){var e=Nt();return"[null]"!=Vt([e])||"{}"!=Vt({a:e})||"{}"!=Vt(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!ei(e)){for(var t,i,n=[e],r=1;arguments.length>r;)n.push(arguments[r++]);return"function"==typeof(t=n[1])&&(i=t),!i&&At(t)||(t=function(e,t){if(i&&(t=i.call(this,e,t)),!ei(t))return t}),n[1]=t,Vt.apply(Ft,n)}}}),Nt.prototype[Gt]||re(Nt.prototype,Gt,Nt.prototype.valueOf),Ze(Nt,"Symbol"),Ze(Math,"Math",!0),Ze(z.JSON,"JSON",!0),bt("asyncIterator"),bt("observable");var li=G.Symbol,ci=t(function(e){e.exports={default:li,__esModule:!0}}),hi=e(t(function(e,t){function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=i(gt),r=i(ci),a="function"==typeof r.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":typeof e};t.default="function"==typeof r.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":void 0===e?"undefined":a(e)}}));!function(e,t){var i=(G.Object||{})[e]||Object[e],n={};n[e]=t(i),oe(oe.S+oe.F*X(function(){i(1)}),"Object",n)}("keys",function(){return function(e){return Ne(Qe(e))}});var fi=G.Object.keys,di=(t(function(e){e.exports={default:fi,__esModule:!0}}),Math.floor);oe(oe.S,"Number",{isInteger:function(e){return!W(e)&&isFinite(e)&&di(e)===e}});var vi=G.Number.isInteger,pi=(t(function(e){e.exports={default:vi,__esModule:!0}}),"\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"),mi="["+pi+"]",gi=RegExp("^"+mi+mi+"*"),yi=RegExp(mi+mi+"*$"),_i=function(e,t,i){var n={},r=X(function(){return!!pi[e]()||"​"!="​"[e]()}),a=n[e]=r?t(bi):pi[e];i&&(n[i]=a),oe(oe.P+oe.F*r,"String",n)},bi=_i.trim=function(e,t){return e=String(ve(e)),1&t&&(e=e.replace(gi,"")),2&t&&(e=e.replace(yi,"")),e},wi=_i,ki=z.parseFloat,Si=wi.trim,xi=1/ki(pi+"-0")!=-1/0?function(e){var t=Si(String(e),3),i=ki(t);return 0===i&&"-"==t.charAt(0)?-0:i}:ki;oe(oe.S+oe.F*(Number.parseFloat!=xi),"Number",{parseFloat:xi});var Ai=parseFloat,Ei=(t(function(e){e.exports={default:Ai,__esModule:!0}}),function(){function e(){V(this,e)}return ce(e,null,[{key:"error",value:function(t,i){e.ENABLE_ERROR&&(console.error||console.warn||console.log)(c(t,i))}},{key:"info",value:function(t,i){e.ENABLE_INFO&&(console.info||console.log)(c(t,i))}},{key:"warn",value:function(t,i){e.ENABLE_WARN&&(console.warn||console.log)(c(t,i))}},{key:"debug",value:function(t,i){e.ENABLE_DEBUG&&(console.debug||console.log)(c(t,i))}},{key:"verbose",value:function(t,i){e.ENABLE_VERBOSE&&console.log(c(t,i))}}]),e}());Ei.GLOBAL_TAG="chimee",Ei.FORCE_GLOBAL_TAG=!1,Ei.ENABLE_ERROR=!0,Ei.ENABLE_INFO=!0,Ei.ENABLE_WARN=!0,Ei.ENABLE_DEBUG=!0,Ei.ENABLE_VERBOSE=!0;var Ti=t(function(e,t){!function(i,n){var r="model",a="name",o="type",s="vendor",u="version",l="mobile",c="tablet",h={extend:function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},f={rgx:function(e,t){for(var i,n,r,a,o,s,u=0;u<t.length&&!o;){var l=t[u],c=t[u+1];for(i=n=0;i<l.length&&!o;)if(o=l[i++].exec(e))for(r=0;r<c.length;r++)s=o[++n],"object"==typeof(a=c[r])&&a.length>0?2==a.length?"function"==typeof a[1]?this[a[0]]=a[1].call(this,s):this[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?this[a[0]]=s?s.replace(a[1],a[2]):void 0:this[a[0]]=s?a[1].call(this,s,a[2]):void 0:4==a.length&&(this[a[0]]=s?a[3].call(this,s.replace(a[1],a[2])):void 0):this[a]=s||void 0;u+=2}},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(h.has(t[i][n],e))return"?"===i?void 0:i}else if(h.has(t[i],e))return"?"===i?void 0:i;return e}},d={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},v={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[a,u],[/(opios)[\/\s]+([\w\.]+)/i],[[a,"Opera Mini"],u],[/\s(opr)\/([\w\.]+)/i],[[a,"Opera"],u],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[a,u],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[a,"IE"],u],[/(edge)\/((\d+)?[\w\.]+)/i],[a,u],[/(yabrowser)\/([\w\.]+)/i],[[a,"Yandex"],u],[/(puffin)\/([\w\.]+)/i],[[a,"Puffin"],u],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[a,"UCBrowser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],u],[/(micromessenger)\/([\w\.]+)/i],[[a,"WeChat"],u],[/(QQ)\/([\d\.]+)/i],[a,u],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[a,u],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[u,[a,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[u,[a,"Facebook"]],[/(headlesschrome) ([\w\.]+)/i],[u,[a,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[a,/(.+)/,"$1 WebView"],u],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[a,/(.+(?:g|us))(.+)/,"$1 $2"],u],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[u,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[a,u],[/(dolfin)\/([\w\.]+)/i],[[a,"Dolphin"],u],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[a,"Chrome"],u],[/(coast)\/([\w\.]+)/i],[[a,"Opera Coast"],u],[/fxios\/([\w\.-]+)/i],[u,[a,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[u,[a,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[u,a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[a,[u,f.str,d.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[a,u],[/(navigator|netscape)\/([\w\.-]+)/i],[[a,"Netscape"],u],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[a,u]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",h.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",h.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",h.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,s,[o,c]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[s,"Apple"],[o,c]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,r,[o,c]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[r,[s,"Amazon"],[o,c]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[r,f.str,d.device.amazon.model],[s,"Amazon"],[o,l]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,s,[o,l]],[/\((ip[honed|\s\w*]+);/i],[r,[s,"Apple"],[o,l]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,r,[o,l]],[/\(bb10;\s(\w+)/i],[r,[s,"BlackBerry"],[o,l]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[s,"Asus"],[o,c]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[r,"Xperia Tablet"],[o,c]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[r,[s,"Sony"],[o,l]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,r,[o,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[s,"Nvidia"],[o,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[s,"Sony"],[o,"console"]],[/(sprint\s(\w+))/i],[[s,f.str,d.device.sprint.vendor],[r,f.str,d.device.sprint.model],[o,l]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,r,[o,c]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[r,/_/g," "],[o,l]],[/(nexus\s9)/i],[r,[s,"HTC"],[o,c]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[r,[s,"Huawei"],[o,l]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,r,[o,l]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[s,"Microsoft"],[o,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[s,"Microsoft"],[o,l]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[s,"Motorola"],[o,l]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[s,"Motorola"],[o,c]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,h.trim],[r,h.trim],[o,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[s,"Samsung"],[o,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[s,"Sharp"],[o,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],r,[o,c]],[/smart-tv.+(samsung)/i],[s,[o,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],r,[o,l]],[/sie-(\w+)*/i],[r,[s,"Siemens"],[o,l]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],r,[o,l]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[s,"Acer"],[o,c]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[s,"LG"],[o,c]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],r,[o,c]],[/(lg) netcast\.tv/i],[s,r,[o,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[s,"LG"],[o,l]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[s,"Lenovo"],[o,c]],[/linux;.+((jolla));/i],[s,r,[o,l]],[/((pebble))app\/[\d\.]+\s/i],[s,r,[o,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[s,r,[o,l]],[/crkey/i],[[r,"Chromecast"],[s,"Google"]],[/android.+;\s(glass)\s\d/i],[r,[s,"Google"],[o,"wearable"]],[/android.+;\s(pixel c)\s/i],[r,[s,"Google"],[o,c]],[/android.+;\s(pixel xl|pixel)\s/i],[r,[s,"Google"],[o,l]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[r,/_/g," "],[s,"Xiaomi"],[o,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[s,"Meizu"],[o,c]],[/android.+a000(1)\s+build/i],[r,[s,"OnePlus"],[o,l]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[s,"RCA"],[o,c]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[r,[s,"Dell"],[o,c]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[s,"Verizon"],[o,c]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[s,"Barnes & Noble"],r,[o,c]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[s,"NuVision"],[o,c]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[s,"ZTE"],r,[o,c]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[s,"Swiss"],[o,l]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[s,"Swiss"],[o,c]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[s,"Zeki"],[o,c]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[s,"Dragon Touch"],r,[o,c]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[r,[s,"Insignia"],[o,c]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[r,[s,"NextBook"],[o,c]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[s,"Voice"],r,[o,l]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[s,"LvTel"],r,[o,l]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[s,"Envizen"],[o,c]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[s,r,[o,c]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[s,"MachSpeed"],[o,c]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[s,r,[o,c]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[s,"Rotor"],[o,c]],[/android.+(KS(.+))\s+build/i],[r,[s,"Amazon"],[o,c]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[s,r,[o,c]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[o,h.lowerize],s,r],[/(android.+)[;\/].+build/i],[r,[s,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[u,[a,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,u],[/rv\:([\w\.]+).*(gecko)/i],[u,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[u,f.str,d.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[u,f.str,d.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[a,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],u],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],u],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],u],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,u],[/(haiku)\s(\w+)/i],[a,u],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[u,/_/g,"."],[a,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[a,"Mac OS"],[u,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[a,u]]},p=function(e,t){this[a]=e,this[u]=t},m=function(e){this.architecture=e},g=function(e,t,i){this[s]=e,this[r]=t,this[o]=i},y=p,_=p,b=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof b))return new b(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?h.extend(v,t):v,a=new p,o=new m,s=new g,u=new y,l=new _;return this.getBrowser=function(){return f.rgx.call(a,n,r.browser),a.major=h.major(a.version),a},this.getCPU=function(){return f.rgx.call(o,n,r.cpu),o},this.getDevice=function(){return f.rgx.call(s,n,r.device),s},this.getEngine=function(){return f.rgx.call(u,n,r.engine),u},this.getOS=function(){return f.rgx.call(l,n,r.os),l},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,a=new p,o=new m,s=new g,u=new y,l=new _,this},this};b.VERSION="0.7.14",b.BROWSER={NAME:a,MAJOR:"major",VERSION:u},b.CPU={ARCHITECTURE:"architecture"},b.DEVICE={MODEL:r,VENDOR:s,TYPE:o,CONSOLE:"console",MOBILE:l,SMARTTV:"smarttv",TABLET:c,WEARABLE:"wearable",EMBEDDED:"embedded"},b.ENGINE={NAME:a,VERSION:u},b.OS={NAME:a,VERSION:u},e.exports&&(t=e.exports=b),t.UAParser=b;var w=i&&(i.jQuery||i.Zepto);if(void 0!==w){var k=new b;w.ua=k.getResult(),w.ua.get=function(){return k.getUA()},w.ua.set=function(e){k.setUA(e);var t=k.getResult();for(var i in t)w.ua[i]=t[i]}}}("object"==typeof window?window:F)}),Bi=function(e,t,i,n){try{return n?t(K(i)[0],i[1]):t(i)}catch(t){var r=e.return;throw void 0!==r&&K(r.call(e)),t}},Li=We("iterator"),Ci=Array.prototype,Oi=function(e){return void 0!==e&&(ye.Array===e||Ci[Li]===e)},Di=function(e,t,i){t in e?ie.f(e,t,ne(0,i)):e[t]=i},Mi=We("toStringTag"),Ri="Arguments"==be(function(){return arguments}()),Ii=function(e,t){try{return e[t]}catch(e){}},Ui=function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=Ii(t=Object(e),Mi))?i:Ri?be(t):"Object"==(n=be(t))&&"function"==typeof t.callee?"Arguments":n},Pi=We("iterator"),ji=G.getIteratorMethod=function(e){if(void 0!=e)return e[Pi]||e["@@iterator"]||ye[Ui(e)]},Ni=We("iterator"),Fi=!1;try{var Vi=[7][Ni]();Vi.return=function(){Fi=!0},Array.from(Vi,function(){throw 2})}catch(e){}var zi=function(e,t){if(!t&&!Fi)return!1;var i=!1;try{var n=[7],r=n[Ni]();r.next=function(){return{done:i=!0}},n[Ni]=function(){return r},e(n)}catch(e){}return i};oe(oe.S+oe.F*!zi(function(e){Array.from(e)}),"Array",{from:function(e){var t,i,n,r,a=Qe(e),o="function"==typeof this?this:Array,s=arguments.length,u=s>1?arguments[1]:void 0,l=void 0!==u,c=0,h=ji(a);if(l&&(u=H(u,s>2?arguments[2]:void 0,2)),void 0==h||o==Array&&Oi(h))for(i=new o(t=xe(a.length));t>c;c++)Di(i,c,l?u(a[c],c):a[c]);else for(r=h.call(a),i=new o;!(n=r.next()).done;c++)Di(i,c,l?Bi(r,u,[n.value,c],!0):n.value);return i.length=c,i}});var Gi,qi,Hi,Wi=G.Array.from,Ki=t(function(e){e.exports={default:Wi,__esModule:!0}}),Xi=e(Ki),Zi=(e(t(function(e,t){t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(Ki);t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}})),function(e){function t(i,r,o){if(n(i)||a(i)){r=r||(a(i)?{}:[]);for(var s in i)r[s]=t(i[s],r[s],s);return r}return e(i,r,o)}return t}(function(e){return e})),Yi=function(e,t,i,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(i+": incorrect invocation!");return e},Ji=t(function(e){var t={},i={},n=e.exports=function(e,n,r,a,o){var s,u,l,c,h=o?function(){return e}:ji(e),f=H(r,a,n?2:1),d=0;if("function"!=typeof h)throw TypeError(e+" is not iterable!");if(Oi(h)){for(s=xe(e.length);s>d;d++)if((c=n?f(K(u=e[d])[0],u[1]):f(e[d]))===t||c===i)return c}else for(l=h.call(e);!(u=l.next()).done;)if((c=Bi(l,f,u.value,n))===t||c===i)return c};n.BREAK=t,n.RETURN=i}),Qi=We("species"),$i=function(e,t){var i,n=K(e).constructor;return void 0===n||void 0==(i=K(n)[Qi])?t:q(i)},en=function(e,t,i){var n=void 0===i;switch(t.length){case 0:return n?e():e.call(i);case 1:return n?e(t[0]):e.call(i,t[0]);case 2:return n?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)},tn=z.process,nn=z.setImmediate,rn=z.clearImmediate,an=z.MessageChannel,on=0,sn={},un=function(){var e=+this;if(sn.hasOwnProperty(e)){var t=sn[e];delete sn[e],t()}},ln=function(e){un.call(e.data)};nn&&rn||(nn=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return sn[++on]=function(){en("function"==typeof e?e:Function(e),t)},Gi(on),on},rn=function(e){delete sn[e]},"process"==be(tn)?Gi=function(e){tn.nextTick(H(un,e,1))}:an?(Hi=(qi=new an).port2,qi.port1.onmessage=ln,Gi=H(Hi.postMessage,Hi,1)):z.addEventListener&&"function"==typeof postMessage&&!z.importScripts?(Gi=function(e){z.postMessage(e+"","*")},z.addEventListener("message",ln,!1)):Gi="onreadystatechange"in Q("script")?function(e){Ve.appendChild(Q("script")).onreadystatechange=function(){Ve.removeChild(this),un.call(e)}}:function(e){setTimeout(H(un,e,1),0)});var cn,hn,fn,dn={set:nn,clear:rn},vn=dn.set,pn=z.MutationObserver||z.WebKitMutationObserver,mn=z.process,gn=z.Promise,yn="process"==be(mn),_n=We("species"),bn=dn.set,wn=function(){var e,t,i,n=function(){var n,r;for(yn&&(n=mn.domain)&&n.exit();e;){r=e.fn,e=e.next;try{r()}catch(n){throw e?i():t=void 0,n}}t=void 0,n&&n.enter()};if(yn)i=function(){mn.nextTick(n)};else if(pn){var r=!0,a=document.createTextNode("");new pn(n).observe(a,{characterData:!0}),i=function(){a.data=r=!r}}else if(gn&&gn.resolve){var o=gn.resolve();i=function(){o.then(n)}}else i=function(){vn.call(z,n)};return function(n){var r={fn:n,next:void 0};t&&(t.next=r),e||(e=r,i()),t=r}}(),kn=z.TypeError,Sn=z.process,xn=z.Promise,Sn=z.process,An="process"==Ui(Sn),En=function(){},Tn=!!function(){try{var e=xn.resolve(1),t=(e.constructor={})[We("species")]=function(e){e(En,En)};return(An||"function"==typeof PromiseRejectionEvent)&&e.then(En)instanceof t}catch(e){}}(),Bn=function(e,t){return e===t||e===xn&&t===fn},Ln=function(e){var t;return!(!W(e)||"function"!=typeof(t=e.then))&&t},Cn=function(e){return Bn(xn,e)?new On(e):new hn(e)},On=hn=function(e){var t,i;this.promise=new e(function(e,n){if(void 0!==t||void 0!==i)throw kn("Bad Promise constructor");t=e,i=n}),this.resolve=q(t),this.reject=q(i)},Dn=function(e){try{e()}catch(e){return{error:e}}},Mn=function(e,t){if(!e._n){e._n=!0;var i=e._c;wn(function(){for(var n=e._v,r=1==e._s,a=0;i.length>a;)!function(t){var i,a,o=r?t.ok:t.fail,s=t.resolve,u=t.reject,l=t.domain;try{o?(r||(2==e._h&&Un(e),e._h=1),!0===o?i=n:(l&&l.enter(),i=o(n),l&&l.exit()),i===t.promise?u(kn("Promise-chain cycle")):(a=Ln(i))?a.call(i,s,u):s(i)):u(n)}catch(e){u(e)}}(i[a++]);e._c=[],e._n=!1,t&&!e._h&&Rn(e)})}},Rn=function(e){bn.call(z,function(){var t,i,n,r=e._v;if(In(e)&&(t=Dn(function(){An?Sn.emit("unhandledRejection",r,e):(i=z.onunhandledrejection)?i({promise:e,reason:r}):(n=z.console)&&n.error&&n.error("Unhandled promise rejection",r)}),e._h=An||In(e)?2:1),e._a=void 0,t)throw t.error})},In=function(e){if(1==e._h)return!1;for(var t,i=e._a||e._c,n=0;i.length>n;)if((t=i[n++]).fail||!In(t.promise))return!1;return!0},Un=function(e){bn.call(z,function(){var t;An?Sn.emit("rejectionHandled",e):(t=z.onrejectionhandled)&&t({promise:e,reason:e._v})})},Pn=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Mn(t,!0))},jn=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw kn("Promise can't be resolved itself");(t=Ln(e))?wn(function(){var n={_w:i,_d:!1};try{t.call(e,H(jn,n,1),H(Pn,n,1))}catch(e){Pn.call(n,e)}}):(i._v=e,i._s=1,Mn(i,!1))}catch(e){Pn.call({_w:i,_d:!1},e)}}};Tn||(xn=function(e){Yi(this,xn,"Promise","_h"),q(e),cn.call(this);try{e(H(jn,this,1),H(Pn,this,1))}catch(e){Pn.call(this,e)}},(cn=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,i){for(var n in t)i&&e[n]?e[n]=t[n]:re(e,n,t[n]);return e}(xn.prototype,{then:function(e,t){var i=Cn($i(this,xn));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=An?Sn.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&Mn(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),On=function(){var e=new cn;this.promise=e,this.resolve=H(jn,e,1),this.reject=H(Pn,e,1)}),oe(oe.G+oe.W+oe.F*!Tn,{Promise:xn}),Ze(xn,"Promise"),function(e){var t="function"==typeof G[e]?G[e]:z[e];Z&&t&&!t[_n]&&ie.f(t,_n,{configurable:!0,get:function(){return this}})}("Promise"),fn=G.Promise,oe(oe.S+oe.F*!Tn,"Promise",{reject:function(e){var t=Cn(this);return(0,t.reject)(e),t.promise}}),oe(oe.S+!0*oe.F,"Promise",{resolve:function(e){if(e instanceof xn&&Bn(e.constructor,this))return e;var t=Cn(this);return(0,t.resolve)(e),t.promise}}),oe(oe.S+oe.F*!(Tn&&zi(function(e){xn.all(e).catch(En)})),"Promise",{all:function(e){var t=this,i=Cn(t),n=i.resolve,r=i.reject,a=Dn(function(){var i=[],a=0,o=1;Ji(e,!1,function(e){var s=a++,u=!1;i.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,i[s]=e,--o||n(i))},r)}),--o||n(i)});return a&&r(a.error),i.promise},race:function(e){var t=this,i=Cn(t),n=i.reject,r=Dn(function(){Ji(e,!1,function(e){t.resolve(e).then(i.resolve,n)})});return r&&n(r.error),i.promise}});var Nn=G.Promise,Fn=(t(function(e){e.exports={default:Nn,__esModule:!0}}),"undefined"!=typeof window&&Object.prototype.toString.call(window),Object.assign),Vn=!Fn||X(function(){var e={},t={},i=Symbol(),n="abcdefghijklmnopqrst";return e[i]=7,n.split("").forEach(function(e){t[e]=e}),7!=Fn({},e)[i]||Object.keys(Fn({},t)).join("")!=n})?function(e,t){for(var i=Qe(e),n=arguments.length,r=1,a=kt.f,o=St.f;n>r;)for(var s,u=we(arguments[r++]),l=a?Ne(u).concat(a(u)):Ne(u),c=l.length,h=0;c>h;)o.call(u,s=l[h++])&&(i[s]=u[s]);return i}:Fn;oe(oe.S+oe.F,"Object",{assign:Vn});var zn=G.Object.assign,Gn=e(t(function(e){e.exports={default:zn,__esModule:!0}}));oe(oe.S,"Object",{create:He});var qn=G.Object,Hn=function(e,t){return qn.create(e,t)},Wn=e(t(function(e){e.exports={default:Hn,__esModule:!0}})),Kn=Wn(null);Kn.count=0;var Xn=function(){function e(t,i){var n=this;if(V(this,e),Object.defineProperty(this,"__target",{writable:!0,enumerable:!1,configurable:!0}),this.__target=this,t){if("object"!==(void 0===t?"undefined":hi(t)))throw new Error("CusEvent target are not object");this.__target=t,i&&["on","once","off","emit"].forEach(function(e){t[e]=n[e]})}}return ce(e,[{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return m(this.__target,e,t,i),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return g(this.__target,e,t,i),this}},{key:"emit",value:function(e,t){return p(this.__target,e,{data:t}),this}}]),e}(),Zn=Wn(null);Zn.count=0;(function(){function e(t,i){var n=this;if(V(this,e),Object.defineProperty(this,"__target",{writable:!0,enumerable:!1,configurable:!0}),this.__target=this,t){if("object"!==(void 0===t?"undefined":hi(t)))throw new Error("CusEvent target are not object");this.__target=t,i&&["on","once","off","emit"].forEach(function(e){t[e]=n[e]})}}ce(e,[{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return b(this.__target,e,t,i),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return w(this.__target,e,t,i),this}},{key:"emit",value:function(e,t){return _(this.__target,e,{data:t}),this}}])})(),"undefined"!=typeof window&&Object.prototype.toString.call(window);var Yn=document.createElement("div"),Jn="innerText";"textContent"in Yn&&(Jn="textContent");var Qn=Array.prototype,$n=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;V(this,e);var r=this;r.selector=t;var a=void 0;t&&t.constructor===NodeList?a=k(t):n(t)?a=t:s(t)?0===t.indexOf("<")?(Yn.innerHTML=t,a=R("*",Yn,!0)):a=R(t,i,!0):a=[t],Gn(r,a),r.length=a.length}return ce(e,[{key:"each",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return Qn.forEach.apply(this,t),this}},{key:"push",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return Qn.push.apply(this,t),this}},{key:"splice",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return P(Qn.splice.apply(this,t))}},{key:"find",value:function(e){var t=[];this.each(function(i){t=t.concat(R(e,i,!0))});var i=P(t);return i.parent=this,i.selector=e,i}},{key:"append",value:function(e){var t=P(e),i=this[0];return t.each(function(e){return i.appendChild(e)}),this}},{key:"appendTo",value:function(e){return P(e).append(this),this}},{key:"text",value:function(e){return 0===arguments.length?this[0][Jn]:this.each(function(t){t[Jn]=e})}},{key:"html",value:function(e){return 0===arguments.length?this[0].innerHTML:this.each(function(t){t.innerHTML=e})}},{key:"attr",value:function(e,t){return 1===arguments.length?S(this[0],e):this.each(function(i){return x(i,e,t)})}},{key:"data",value:function(e,t){return 0===arguments.length?this[0].dataset||{}:1===arguments.length?(this[0].dataset||{})[e]:this.each(function(i){(i.dataset||(i.dataset={}))[e]=t})}},{key:"css",value:function(e,t){return 1!==arguments.length||a(e)?this.each(function(i){return M(i,e,t)}):D(this[0],e)}},{key:"addClass",value:function(e){return this.each(function(t){return A(t,e)})}},{key:"removeClass",value:function(e){return this.each(function(t){return E(t,e)})}},{key:"hasClass",value:function(e){return T(this[0],e)}},{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return L(r,e,t,i,n)})}},{key:"off",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return B(r,e,t,i,n)})}},{key:"delegate",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return C(r,e,t,i,n)})}},{key:"undelegate",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return O(r,e,t,i,n)})}},{key:"remove",value:function(){return this.each(function(e){return I(e)})}}]),e}(),er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ir=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),nr=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},rr=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ar=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},or=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.video=e,n.config=i,n.tag="mse-controller",n.e={onSourceOpen:n.onSourceOpen.bind(n),onSourceEnded:n.onSourceEnded.bind(n),onSourceClose:n.onSourceClose.bind(n),onSourceBufferError:n.onSourceBufferError.bind(n)},n.queue=[],n.removeRangesList=[],n.removeBucketing=!1,n.timer=null,n}return rr(t,Xn),ir(t,[{key:"init",value:function(e){if(this.mediaSource)throw Ei.Error(this.tag,"MediaSource has been attached to an HTMLMediaElement!"),new Error("MediaSource has been attached to an HTMLMediaElement!");e.data.videoCodec||(e.data.videoCodec="avc1.640020"),e.data.audioCodec||(e.data.audioCodec="mp4a.40.2"),this.mimeCodec='video/mp4; codecs="'+e.data.videoCodec+","+e.data.audioCodec+'"';var t=this.mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this.sourceBufferEvent()}},{key:"onSourceOpen",value:function(){var e=this;Ei.verbose(this.tag,"MediaSource onSourceOpen"),this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this.sourceBuffer=this.mediaSource.addSourceBuffer(this.mimeCodec),this.sourceBuffer.addEventListener("error",this.e.onSourceBufferError),this.sourceBuffer.addEventListener("abort",function(){return Ei.verbose(e.tag,"sourceBuffer: abort")}),this.sourceBuffer.addEventListener("updateend",function(){if(e.queue.length>0&&!e.sourceBuffer.updating)if(e.needCleanupSourceBuffer())e.doCleanupSourceBuffer();else{var t=e.queue.shift();e.appendBuffer(t)}e.emit("updateend")}),this.doUpdate(),this.emit("source_open")}},{key:"doUpdate",value:function(){var e=this;if(clearTimeout(this.timer),this.queue.length>0){var t=this.queue.shift();this.appendBuffer(t)}else this.timer=setTimeout(function(){e.doUpdate()},100)}},{key:"sourceBufferEvent",value:function(){var e=this;this.on("mediaSegment",function(t){var i=t.data;!e.sourceBuffer||e.sourceBuffer.updating||e.queue.length>0?e.queue.push(i):e.appendBuffer(i)}),this.on("mediaSegmentInit",function(t){var i=t.data;!e.sourceBuffer||e.sourceBuffer.updating||e.queue.length>0?e.queue.push(i):e.appendBuffer(i)})}},{key:"needCleanupSourceBuffer",value:function(){var e=this.video.currentTime,t=this.sourceBuffer.buffered;return t.length>=1&&e-t.start(0)>=this.config.autoCleanupMaxBackwardDuration}},{key:"doCleanupSourceBuffer",value:function(){Ei.verbose(this.tag,"docleanBuffer");for(var e=this.video.currentTime,t=this.sourceBuffer.buffered,i=!1,n=0;n<t.length;n++){var r=t.start(n),a=t.end(n);if(r<=e&&e<a+3){if(e-r>=this.config.autoCleanupMaxBackwardDuration){i=!0;var o=e-this.config.autoCleanupMinBackwardDuration;this.removeRangesList.push({start:r,end:o})}}else a<e&&(i=!0,this.removeRangesList.push({start:r,end:a}))}i&&!this.sourceBuffer.updating&&this.cleanRangesList()}},{key:"cleanRangesList",value:function(){if(!this.sourceBuffer.updating)for(var e=this.sourceBuffer;this.removeRangesList.length&&!e.updating;){var t=this.removeRangesList.shift();e.remove(t.start,t.end)}}},{key:"appendBuffer",value:function(e){try{this.sourceBuffer.appendBuffer(e)}catch(e){22===e.code&&(Ei.verbose(this.tag,"MediaSource bufferFull"),this.emit("bufferFull"))}}},{key:"onSourceEnded",value:function(){Ei.verbose(this.tag,"MediaSource onSourceEnded")}},{key:"onSourceClose",value:function(){Ei.verbose(this.tag,"MediaSource onSourceClose"),this.mediaSource&&null!==this.e&&(this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this.mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this.mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"onSourceBufferError",value:function(e){Ei.info(e),Ei.error(this.tag,"SourceBuffer Error: "+e)}},{key:"seek",value:function(){}},{key:"destroy",value:function(){if(this.mediaSource){var e=this.mediaSource;this.queue=[];var t=this.sourceBuffer;if(t&&("closed"!==e.readyState&&(e.removeSourceBuffer(t),t.removeEventListener("error",this.e.onSourceBufferError),t.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this.sourceBuffer=null),"open"===e.readyState)try{e.endOfStream()}catch(e){Ei.e(this.tag,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this.mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}}]),t}(),sr=function(e){var t={},i=void 0;return i=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",t.Range=i,{headers:t}},ur=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.tag="fetch",n.fetching=!1,n.config=i,n.range={from:0,to:5e5},n.src=e,n.totalRange=null,n.block=5e5,n.reader=null,n.requestAbort=!1,n.arrivalDataCallback=null,n.bytesStart=0,n}return rr(t,Xn),ir(t,null,[{key:"isSupport",value:function(){return!(!window.fetch||!window.ReadableStream)}}]),ir(t,[{key:"open",value:function(e,t){var i=this;this.requestAbort=!1;var n=new Headers,r=e||{from:0,to:-1};if(!this.config.isLive){this.range.from=r.from,this.range.to=r.to;var a=sr(r).headers;for(var o in a)n.append(o,a[o])}t&&(this.bytesStart=0),this.req=new Request(this.src,{headers:n}),fetch(this.req).then(function(e){if(e.ok){var n=e.body.getReader();return i.pump(n,t)}})}},{key:"pause",value:function(){this.requestAbort=!0}},{key:"pump",value:function(e,t){var i=this;return e.read().then(function(n){if(!n.done){if(!0===i.requestAbort)return e.cancel();var r=n.value.buffer;return i.arrivalDataCallback&&(i.arrivalDataCallback(r,i.bytesStart,t),i.bytesStart+=r.byteLength),i.pump(e)}Ei.verbose(i.tag,"play end")})}}]),t}(),lr=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.tag="RangeLoader",n.xhr=null,n.src=e,n.totalLength=null,n.chunkSizeKB=393216,n.range={},n.bytesStart=0,n}return rr(t,Xn),ir(t,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return!1}}}]),ir(t,[{key:"open",value:function(e){var t=this.xhr=new XMLHttpRequest;t.open("GET",this.src,!0),t.responseType="arraybuffer",t.onreadystatechange=this.onReadyStateChange.bind(this),t.onprogress=this.onProgress.bind(this),t.onload=this.onLoad.bind(this),t.onerror=this.onXhrError.bind(this);var i=e||{from:0,to:-1};this.range.from=i.from,this.range.to=i.to;var n=sr(i).headers;for(var r in n)t.setRequestHeader(r,n[r]);t.send()}},{key:"abort",value:function(){this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr.abort(),this.xhr=null}},{key:"destroy",value:function(){this.xhr&&(this.abort(),this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr=null),this.totalLength=null,this.bytesStart=null,this.range={}}},{key:"onReadyStateChange",value:function(e){var t=this.xhr;if(2===t.readyState&&t.status<200&&t.status>299){var i={from:this.range.from,to:this.range.to,url:this.src,msg:"http Error: http code "+t.status};this.emit(this.tag,i)}}},{key:"onProgress",value:function(e){this.totalLength||(this.totalLength=e.total,this.abort(),this.open({from:0,to:this.chunkSizeKB}))}},{key:"onLoad",value:function(e){if(this.totalLength&&(this.range.to,this.totalLength,this.arrivalDataCallback)){var t=e.target.response;this.arrivalDataCallback(t,this.bytesStart),this.bytesStart+=t.byteLength}}},{key:"onXhrError",value:function(e){var t={from:this.range.from,to:this.range.to,url:this.src,msg:e.constructor.name+" "+e.type};this.emit(this.tag,t)}}]),t}(),cr=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.tag="WebSocketLoader",n.range={from:0,to:5e5},n.src=e,n._ws=null,n._requestAbort=!1,n._receivedLength=0,n}return rr(t,Xn),ir(t,null,[{key:"isSupported",value:function(){try{return void 0!==window.WebSocket}catch(e){return!1}}}]),ir(t,[{key:"destroy",value:function(){this._ws&&this.abort(),nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){try{var i=this._ws=new self.WebSocket(this.src);i.binaryType="arraybuffer",i.onopen=this._onWebSocketOpen.bind(this),i.onclose=this._onWebSocketClose.bind(this),i.onmessage=this._onWebSocketMessage.bind(this),i.onerror=this._onWebSocketError.bind(this)}catch(e){var n={code:e.code,msg:e.message};if(!this._onError)throw new RuntimeException(n.msg);this._onError(LoaderErrors.EXCEPTION,n)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null}},{key:"_onWebSocketOpen",value:function(e){}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?this._onComplete&&this._onComplete(0,this._receivedLength-1):this._requestAbort=!1}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}else{var n={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new RuntimeException(n.msg);this._onError(LoaderErrors.EXCEPTION,n)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,i=this._receivedLength;this._receivedLength+=t.byteLength,this.arrivalDataCallback&&this.arrivalDataCallback(t,i,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){var t={code:e.code,msg:e.message};if(!this._onError)throw new RuntimeException(t.msg);this._onError(LoaderErrors.EXCEPTION,t)}}]),t}(),hr=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.tag="mozChunkLoader",n.xhr=null,n.src=e,n.config=i,n.totalLength=null,n.chunkSizeKB=393216,n.range={},n.bytesStart=0,n}return rr(t,Xn),ir(t,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return!1}}}]),ir(t,[{key:"open",value:function(e){var t=this.xhr=new XMLHttpRequest;if(t.open("GET",this.src,!0),t.responseType="moz-chunked-arraybuffer",t.onreadystatechange=this.onReadyStateChange.bind(this),t.onprogress=this.onProgress.bind(this),t.onload=this.onLoadEnd.bind(this),t.onerror=this.onXhrError.bind(this),!this.config.isLive){var i=e||{from:0,to:-1};this.range.from=i.from,this.range.to=i.to;var n=sr(i).headers;for(var r in n)t.setRequestHeader(r,n[r])}t.send()}},{key:"abort",value:function(){this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr.abort(),this.xhr=null}},{key:"destroy",value:function(){this.xhr&&(this.abort(),this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr=null),this.totalLength=null,this.bytesStart=null,this.range={}}},{key:"onReadyStateChange",value:function(e){var t=this.xhr;if(2===t.readyState&&t.status<200&&t.status>299){var i={from:this.range.from,to:this.range.to,url:this.src,msg:"http Error: http code "+t.status};this.emit(this.tag,i)}}},{key:"onProgress",value:function(e){this.totalLength||(this.totalLength=e.total,null!==e.total&&0!==e.total&&(this.totalLength=e.total));var t=e.target.response;this.arrivalDataCallback(t,this.bytesStart),this.bytesStart+=t.byteLength}},{key:"onLoadEnd",value:function(e){this.emit(this.tag,"video load end")}},{key:"onXhrError",value:function(e){var t={from:this.range.from,to:this.range.to,url:this.src,msg:e.constructor.name+" "+e.type};this.emit(this.tag,t)}}]),t}(),fr=function(e){function t(e){tr(this,t);var i=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.loader=null,i.config={},Object.assign(i.config,e),i.bufferSize=3145728,i.cacheBuffer=new ArrayBuffer(i.bufferSize),i.cacheRemain=0,i.stashByteStart=0,i.enableStash=!0,i.stashSize=393216,i.resumeFrom=0,i.currentRange={},i.totalReceive=0,i.seekPonit=0,i.timer=null,i.webSocketURLReg=/wss?:\/\/(.+?)\//,i.selectLoader(),i}return rr(t,Xn),ir(t,[{key:"selectLoader",value:function(){var e=this.config,t=this.config.src;this.webSocketURLReg.test(t)?this.loader=new cr(t,e):ur.isSupport()?this.loader=new ur(t,e):hr.isSupport()?this.loader=new hr(t,e):lr.isSupport()&&(this.loader=new lr(t,e)),this.loader.arrivalDataCallback=this.onLoaderChunkArrival.bind(this)}},{key:"onLoaderChunkArrival",value:function(e,t,i){if(i&&(this.seekPonit=i),this.arrivalDataCallback)if(this.totalReceive+=e.byteLength,0===this.cacheRemain&&0===this.stashByteStart&&(this.stashByteStart=t),this.cacheRemain+e.byteLength<=this.stashSize)new Uint8Array(this.cacheBuffer,0,this.stashSize).set(new Uint8Array(e),this.cacheRemain),this.cacheRemain+=e.byteLength;else{var n=new Uint8Array(this.cacheBuffer,0,this.bufferSize);if(this.cacheRemain>0){var r=this.cacheBuffer.slice(0,this.cacheRemain),a=0;if(this.seekPonit?(a=this.arrivalDataCallback(r,this.stashByteStart,this.seekPonit),this.seekPonit=0):a=this.arrivalDataCallback(r,this.stashByteStart),a<r.byteLength){if(a>0){var o=new Uint8Array(r,a);n.set(o,0),this.cacheRemain=o.byteLength,this.stashByteStart+=a}}else this.cacheRemain=0,this.stashByteStart+=a;this.cacheRemain+e.byteLength>this.bufferSize&&(this.expandBuffer(this.cacheRemain+e.byteLength),n=new Uint8Array(this.cacheBuffer,0,this.bufferSize)),n.set(new Uint8Array(e),this.cacheRemain),this.cacheRemain+=e.byteLength}else{var s=0;if(this.seekPonit?(s=this.arrivalDataCallback(e,t,this.seekPonit),this.seekPonit=0):s=this.arrivalDataCallback(e,t),s<e.byteLength){var u=e.byteLength-s;u>this.bufferSize&&(this.expandBuffer(u),n=new Uint8Array(this.cacheBuffer,0,this.bufferSize)),n.set(new Uint8Array(e,s),0),this.cacheRemain+=u,this.stashByteStart=t+s}}}}},{key:"initCacheBuffer",value:function(){this.cacheBuffer=new ArrayBuffer(this.bufferSize)}},{key:"expandBuffer",value:function(e){var t=this.bufferSize;t<e&&(t=e),this.cacheBuffer=new ArrayBuffer(t),this.bufferSize=t}},{key:"pause",value:function(){this.loader.pause()}},{key:"open",value:function(e){void 0===e&&(e=0),this.loader.open({from:e,to:-1})}},{key:"resume",value:function(){this.paused=!1;var e=this.totalReceive;this.open(e)}},{key:"seek",value:function(e,t,i){this.loader.open({from:e,to:-1},i)}},{key:"destroy",value:function(){this.pause(),this.cacheBuffer=null}}]),t}(),dr=arguments[3],vr=arguments[4],pr=arguments[5],mr=JSON.stringify,gr=function(e,t){function i(e){f[e]=!0;for(var t in vr[e][1]){var n=vr[e][1][t];f[n]||i(n)}}for(var n,r=Object.keys(pr),a=0,o=r.length;a<o;a++){var s=r[a],u=pr[s].exports;if(u===e||u&&u.default===e){n=s;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var l={},a=0,o=r.length;a<o;a++)l[s=r[a]]=s;vr[n]=[Function(["require","module","exports"],"("+e+")(self)"),l]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),h={};h[n]=n,vr[c]=[Function(["require"],"var f = require("+mr(n)+");(f.default ? f.default : f)(self);"),h];var f={};i(c);var d="("+dr+")({"+Object.keys(f).map(function(e){return mr(e)+":["+vr[e][0]+","+mr(vr[e][1])+"]"}).join(",")+"},{},["+mr(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,p=new Blob([d],{type:"text/javascript"});if(t&&t.bare)return p;var m=v.createObjectURL(p),g=new Worker(m);return g.objectURL=m,g},yr=function(){function e(){tr(this,e),this.tagType=-1,this.dataSize=-1,this.Timestamp=-1,this.StreamID=-1,this.body=-1,this.time=-1,this.arr=[]}return ir(e,[{key:"getTime",value:function(){this.arr=[];for(var e=0;e<this.Timestamp.length;e++)this.arr.push(1==this.Timestamp[e].toString(16).length?"0"+this.Timestamp[e].toString(16):this.Timestamp[e].toString(16));this.arr.pop();var t=this.arr.join("");return this.time=parseInt(t,16),parseInt(t,16)}}]),e}(),_r=function(){function e(t){tr(this,e),this.TAG=this.constructor.name,this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return ir(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(n,this._current_word_bits_left),a=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,i=i<<r|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),br=function(){function e(){tr(this,e)}return ir(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,n=new Uint8Array(i),r=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[r]=t[a],r++);return new Uint8Array(n.buffer,0,r)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),n=new _r(i);n.readByte();var r=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var o=e.getProfileString(r),s=e.getLevelString(a),u=1,l=420,c=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=n.readUEG())&&n.readBits(1),u<=3&&(l=c[u]),h=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)n.readBool()&&(d<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var v=n.readUEG();if(0===v)n.readUEG();else if(1===v){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),m=0;m<p;m++)n.readSEG()}n.readUEG(),n.readBits(1);var g=n.readUEG(),y=n.readUEG(),_=n.readBits(1);0===_&&n.readBits(1),n.readBits(1);var b=0,w=0,k=0,S=0;n.readBool()&&(b=n.readUEG(),w=n.readUEG(),k=n.readUEG(),S=n.readUEG());var x=1,A=1,E=0,T=!0,B=0,L=0;if(n.readBool()){if(n.readBool()){var C=n.readByte(),O=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],D=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];C>0&&C<16?(x=O[C-1],A=D[C-1]):255===C&&(x=n.readByte()<<8|n.readByte(),A=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var M=n.readBits(32),R=n.readBits(32);T=n.readBool(),E=(B=R)/(L=2*M)}}var I=1;1===x&&1===A||(I=x/A);var U=0,P=0;0===u?(U=1,P=2-_):(U=3===u?1:2,P=(1===u?2:1)*(2-_));var j=16*(g+1),N=16*(y+1)*(2-_);j-=(b+w)*U,N-=(k+S)*P;var F=Math.ceil(j*I);return n.destroy(),n=null,{profile_string:o,level_string:s,bit_depth:h,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:T,fps:E,fps_den:L,fps_num:B},sar_ratio:{width:x,height:A},codec_size:{width:j,height:N},present_size:{width:F,height:N}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+e.readSEG()+256)%256),i=0===n?i:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}(),wr=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),kr=function(){function e(){tr(this,e)}return ir(e,null,[{key:"parseObject",value:function(t,i,n){var r=e.parseString(t,i,n),a=e.parseScript(t,i+r.size),o=a.objectEnd;return{data:{name:r.data,value:a.data},size:a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,i,n){return e.parseObject(t,i,n)}},{key:"parseLongString",value:function(e,t,i){var n=new DataView(e,t).getUint32(0,!wr),r=void 0;return r=n>0?j(new Uint8Array(e,t+4,n)):"",{data:r,size:4+n}}},{key:"parseDate",value:function(e,t,i){var n=new DataView(e,t),r=n.getFloat64(0,!wr);return r+=60*n.getInt16(8,!wr)*1e3,{data:new Date(r),size:10}}},{key:"parseString",value:function(e,t,i){var n=new DataView(e,t).getUint16(0,!wr),r=void 0;return r=n>0?j(new Uint8Array(e,t+2,n)):"",{data:r,size:2+n}}},{key:"parseMetadata",value:function(t){var i=e.parseScript(t,0),n=e.parseScript(t,i.size,t.length-i.size),r={};return r[i.data]=n.data,r}},{key:"parseScript",value:function(t,i,n){var r=i,a=new Uint8Array(t).buffer,o=new DataView(a,0,n),s=null,u=o.getUint8(r);switch(r+=1,u){case 0:s=o.getFloat64(r,!wr),r+=8;break;case 1:s=!!o.getUint8(r),r+=1;break;case 2:var l=e.parseString(a,r);s=l.data,r+=l.size;break;case 3:s={};var c=0;for(9==(16777215&o.getUint32(n-4,!wr))&&(c=3);r<n-4;){var h=e.parseObject(a,r,n-i-c);if(h.objectEnd)break;s[h.data.name]=h.data.value,r=h.size}r<=n-3&&9===(16777215&v.getUint32(r-1,!wr))&&(r+=3);break;case 8:s={},r+=4;for(9==(16777215&o.getUint32(n-4,!wr))&&3;r<n-8;){var f=e.parseVariable(a,r);if(f.objectEnd)break;s[f.data.name]=f.data.value,r=f.size}r<=n-3&&9===(16777215&o.getUint32(r-1,!wr))&&(r+=3);break;case 9:s=void 0,r=1,!0;break;case 10:s=[];var d=o.getUint32(r,!wr);r+=4;for(var p=0;p<d;p++){var m=e.parseScript(a,r);s.push(m.data),r=m.size}break;case 11:var g=e.parseDate(a,r+1,n-1);s=g.data,r+=g.size;break;case 12:var y=e.parseString(a,r+1,n-1);s=y.data,r+=y.size;break;default:r=n,console.log("AMF","Unsupported AMF value type "+u)}return{data:s,size:r}}}]),e}(),Sr=function(){function e(){tr(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return ir(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}}]),e}(),xr=function e(t){tr(this,e),this.type=t},Ar=new(function(){function e(){tr(this,e),this.TAG=this.constructor.name,this._config={},this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=0,this._firstParse=!0,this._dispatch=!1,this._hasAudio=!1,this._hasVideo=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new Sr,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._videoTrack={type:"video",id:1,sequenceNumber:0,addcoefficient:2,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:1,addcoefficient:2,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return ir(e,[{key:"onMediaInfo",value:function(e){this._onMediaInfo=e}},{key:"parseMetadata",value:function(e){var t=kr.parseMetadata(e);this._parseScriptData(t)}},{key:"_parseScriptData",value:function(e){var t=e;if(t.hasOwnProperty("onMetaData")){this._metadata&&console.log(this.TAG,"Found another onMetaData tag!"),this._metadata=t;var i=this._metadata.onMetaData;if("boolean"==typeof i.hasAudio&&(this._hasAudio=i.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof i.hasVideo&&(this._hasVideo=i.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof i.audiodatarate&&(this._mediaInfo.audioDataRate=i.audiodatarate),"number"==typeof i.videodatarate&&(this._mediaInfo.videoDataRate=i.videodatarate),"number"==typeof i.width&&(this._mediaInfo.width=i.width),"number"==typeof i.height&&(this._mediaInfo.height=i.height),"number"==typeof i.duration){if(!this._durationOverrided){var n=Math.floor(i.duration*this._timescale);this._duration=n,this._mediaInfo.duration=n}}else this._mediaInfo.duration=0;if("number"==typeof i.framerate){var r=Math.floor(1e3*i.framerate);if(r>0){var a=r/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=a,this._referenceFrameRate.fps_num=r,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=a}}if("object"===er(i.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var o=i.keyframes;o.times=i.times,o.filepositions=i.filepositions,this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(o),i.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;return this._dispatch=!1,this._mediaInfo.metadata=i,console.log(this.TAG,"Parsed onMetaData"),this._mediaInfo}}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],i=[],n=1;n<e.times.length;n++){var r=this._timestampBase+Math.floor(1e3*e.times[n]);t.push(r),i.push(e.filepositions[n])}return{times:t,filepositions:i}}},{key:"moofTag",value:function(e){for(var t=0;t<e.length;t++)this._dispatch=!0,this.parseChunks(e[t]);this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack)}},{key:"parseChunks",value:function(e){switch(e.tagType){case 8:this._parseAudioData(e.body.buffer,0,e.body.length,e.getTime());break;case 9:this._parseVideoData(e.body.buffer,0,e.body.length,e.getTime(),0);break;case 18:this.parseMetadata(e.body)}}},{key:"_parseVideoData",value:function(e,t,i,n,r){if(n==this._timestampBase&&0!=this._timestampBase)throw new xr(n+this._timestampBase+"夭寿啦这个视频不是从0开始");if(i<=1)console.log(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else{var a=new Uint8Array(e,t,i)[0],o=(240&a)>>>4,s=15&a;if(7!==s)throw new xr("Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(e,t+1,i-1,n,r,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,i,n,r,a){if(i<4)console.log(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var o=this._littleEndian,s=new DataView(e,t,i),u=s.getUint8(0),l=16777215&s.getUint32(0,!o);if(0===u)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===u)this._parseAVCVideoData(e,t+4,i-4,n,r,a,l);else if(2!==u)throw new xr("Flv: Invalid video packet type "+u)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){if(i<7)console.log(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,r=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,i);n?void 0!==n.avcc&&console.log(this.TAG,"Found another AVCDecoderConfigurationRecord!"):((n=this._videoMetadata={}).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration);var s=o.getUint8(0),u=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1===s&&0!==u)if(this._naluLengthSize=1+(3&o.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var l=31&o.getUint8(5);if(0===l||l>1)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 SPS count: "+l);else{for(var c=6,h=0;h<l;h++){var f=o.getUint16(c,!a);if(c+=2,0!==f){var d=new Uint8Array(e,t+c,f);c+=f;var v=br.parseSPS(d);n.codecWidth=v.codec_size.width,n.codecHeight=v.codec_size.height,n.presentWidth=v.present_size.width,n.presentHeight=v.present_size.height,n.config=v,n.profile=v.profile_string,n.level=v.level_string,n.bitDepth=v.bit_depth,n.chromaFormat=v.chroma_format,n.sarRatio=v.sar_ratio,n.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var p=n.frameRate.fps_den,m=n.frameRate.fps_num;n.refSampleDuration=Math.floor(n.timescale*(p/m));for(var g=d.subarray(1,4),y="avc1.",_=0;_<3;_++){var b=g[_].toString(16);b.length<2&&(b="0"+b),y+=b}n.codec=y;var w=this._mediaInfo;w.width=n.codecWidth,w.height=n.codecHeight,w.fps=n.frameRate.fps,w.profile=n.profile,w.level=n.level,w.chromaFormat=v.chroma_format_string,w.sarNum=n.sarRatio.width,w.sarDen=n.sarRatio.height,w.videoCodec=y,w.meta=n,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this._onMediaInfo(w)}}var k=o.getUint8(c);if(0===k||k>1)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 PPS count: "+k);else{c++;for(var S=0;S<k;S++){var x=o.getUint16(c,!a);c+=2,0!==x&&(c+=x)}n.avcc=new Uint8Array(i),n.avcc.set(new Uint8Array(e,t,i),0),console.log(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",n)}}}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"timestampBase",value:function(e){this._timestampBase=e}},{key:"_parseAVCVideoData",value:function(e,t,i,n,r,a,o){for(var s=this._littleEndian,u=new DataView(e,t,i),l=[],c=0,h=0,f=this._naluLengthSize,d=this._timestampBase+n,v=1===a;h<i;){if(h+4>=i){console.log(this.TAG,"Malformed Nalu near timestamp "+d+", offset = "+h+", dataSize = "+i);break}var p=u.getUint32(h,!s);if(3===f&&(p>>>=8),p>i-f)return void console.log(this.TAG,"Malformed Nalus near timestamp "+d+", NaluSize > DataSize!");var m=31&u.getUint8(h+f);5===m&&(v=!0);var g=new Uint8Array(e,t+h,f+p),y={type:m,data:g};l.push(y),c+=g.byteLength,h+=f+p}if(l.length){var _=this._videoTrack,b={units:l,length:c,isKeyframe:v,dts:d,cts:o,pts:d+o};v&&(b.fileposition=r),_.samples.push(b),_.length+=c}}},{key:"_parseAudioData",value:function(e,t,i,n){if(n==this._timestampBase&&0!=this._timestampBase&&console.log(n,this._timestampBase,"夭寿啦这个视频不是从0开始"),i<=1)console.log(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else{var r=this._audioMetadata,a=this._audioTrack;if(!r||!r.codec){(r=this._audioMetadata={}).type="audio",r.id=a.id,r.timescale=this._timescale,r.duration=this._duration;this._littleEndian;var o=new DataView(e,t,i).getUint8(0),s=o>>>4;if(10!==s)return void this._onError(DemuxErrors.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s);var u=0,l=(12&o)>>>2,c=[5500,11025,22050,44100,48e3];if(!(l<c.length))return void this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);u=c[l];var h=1&o;r.audioSampleRate=u,r.channelCount=0===h?1:2,r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale),r.codec="mp4a.40.5"}var f=this._parseAACAudioData(e,t+1,i-1);if(void 0!=f){if(0===f.packetType){r.config&&console.log(this.TAG,"Found another AudioSpecificConfig!");var d=f.data;r.audioSampleRate=d.samplingRate,r.channelCount=d.channelCount,r.codec=d.codec,r.config=d.config,r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale),console.log(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",r);var v=this._mediaInfo;return v.audioCodec="mp4a.40."+d.originalAudioObjectType,v.audioSampleRate=r.audioSampleRate,v.audioChannelCount=r.channelCount,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',void(v.isComplete()&&this._onMediaInfo(v))}if(1===f.packetType){var p=this._timestampBase+n,m={unit:f.data,dts:p,pts:p};a.samples.push(m),a.length+=f.data.length}else console.log(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}}}},{key:"_parseAACAudioData",value:function(e,t,i){if(!(i<=1)){var n={},r=new Uint8Array(e,t,i);return n.packetType=r[0],0===r[0]?n.data=this._parseAACAudioSpecificConfig(e,t+1,i-1):n.data=r.subarray(1),n}console.log(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,i){var n=new Uint8Array(e,t,i),r=null,a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=0,s=0,u=0,l=null;if(o=s=n[0]>>>3,(u=(7&n[0])<<1|n[1]>>>7)<0||u>=a.length)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var c=a[u],h=(120&n[1])>>>3;if(!(h<0||h>=8)){5===o&&(l=(7&n[1])<<1|n[2]>>>7,(124&n[2])>>>2);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?u>=6?(o=5,r=new Array(4),l=u-3):(o=2,r=new Array(2),l=u):-1!==f.indexOf("android")?(o=2,r=new Array(2),l=u):(o=5,l=u,r=new Array(4),u>=6?l=u-3:1===h&&(o=2,r=new Array(2),l=u)),r[0]=o<<3,r[0]|=(15&u)>>>1,r[1]=(15&u)<<7,r[1]|=(15&h)<<3,5===o&&(r[1]|=(15&l)>>>1,r[2]=(1&l)<<7,r[2]|=8,r[3]=0),{config:r,samplingRate:c,channelCount:h,codec:"mp4a.40."+o,originalAudioObjectType:s}}this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:void 0}},{key:"hasAudio",set:function(e){this._mediaInfo.hasAudio=this._hasAudio=e}},{key:"hasVideo",set:function(e){this._mediaInfo.hasVideo=this._hasVideo=e}}]),e}()),Er=new(function(){function e(){tr(this,e),this.tempUint8=new Uint8Array,this.arrTag=[],this.index=0,this.tempArr=[],this.stop=!1,this.offset=0,this.frist=!0,this._hasAudio=!1,this._hasVideo=!1}return ir(e,[{key:"setFlv",value:function(e){return this.stop=!1,this.arrTag=[],this.index=0,this.tempUint8=e,this.tempUint8.length>13&&70==this.tempUint8[0]&&76==this.tempUint8[1]&&86==this.tempUint8[2]?(this.probe(this.tempUint8.buffer),this.read(9),this.read(4),this.parse(),this.frist=!1,this.offset):this.frist?this.offset:this.parse()}},{key:"probe",value:function(e){var t=new Uint8Array(e),i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var n=(4&t[4])>>>2!=0,r=0!=(1&t[4]);return n||r?(this._hasAudio=Ar._hasAudio=n,this._hasVideo=Ar._hasVideo=r,{match:!0,hasAudioTrack:n,hasVideoTrack:r}):i}},{key:"parse",value:function(){for(;this.index<this.tempUint8.length&&!this.stop;){this.offset=this.index;var e=new yr;if(this.tempUint8.length-this.index>=11){if(e.tagType=this.read(1)[0],e.dataSize=this.read(3),e.Timestamp=this.read(4),e.StreamID=this.read(3),18!=e.tagType&&8!=e.tagType&&9!=e.tagType)throw new xr("wrong tagType"+e.tagType);this.tempUint8.length-this.index>=this.getBodySum(e.dataSize)+4?(e.body=this.read(this.getBodySum(e.dataSize)),9==e.tagType&&this._hasVideo&&this.arrTag.push(e),8==e.tagType&&this._hasAudio&&this.arrTag.push(e),18==e.tagType&&this.arrTag.push(e),this.read(4),this.offset=this.index):this.stop=!0}else this.stop=!0}return this.offset}},{key:"read",value:function(e){var t=this.tempUint8.slice(this.index,this.index+e);return this.index+=e,t}},{key:"getBodySum",value:function(e){var t="";return t+=1==e[0].toString(16).length?"0"+e[0].toString(16):e[0].toString(16),t+=1==e[1].toString(16).length?"0"+e[1].toString(16):e[1].toString(16),t+=1==e[2].toString(16).length?"0"+e[2].toString(16):e[2].toString(16),parseInt(t,16)}}]),e}()),Tr=function(){function e(){tr(this,e)}return ir(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=e.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,i=null,n=Array.prototype.slice.call(arguments,1),r=n.length,a=0;a<r;a++)t+=n[a].byteLength;(i=new Uint8Array(t))[0]=t>>>24&255,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i.set(e,4);for(var o=8,s=0;s<r;s++)i.set(n[s],o),o+=n[s].byteLength;return i}},{key:"generateInitSegment",value:function(t){t.constructor!=Array&&(t=[t]);var i=e.box(e.types.ftyp,e.constants.FTYP),n=e.moov(t),r=new Uint8Array(i.byteLength+n.byteLength);return r.set(i,0),r.set(n,i.byteLength),r}},{key:"moov",value:function(t){var i=e.mvhd(t[0].timescale,t[0].duration),n=e.trak(t[0]),r=void 0;t.length>1&&(r=e.trak(t[1]));var a=e.mvex(t);return t.length>1?e.box(e.types.moov,i,n,r,a):e.box(e.types.moov,i,n,a)}},{key:"mvhd",value:function(t,i){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var i=t.id,n=t.duration,r=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var i=t.timescale,n=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))}},{key:"hdlr",value:function(t){var i=null;return i="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,i)}},{key:"minf",value:function(t){var i=null;return i="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,i,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp4a",value:function(t){var i=t.channelCount,n=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var i=t.config,n=i.length,r=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(i).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var i=t.avcc,n=t.codecWidth,r=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,4,103,49,49,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,i))}},{key:"mvex",value:function(t){return t.length>1?e.box(e.types.mvex,e.trex(t[0]),e.trex(t[1])):e.box(e.types.mvex,e.trex(t[0]))}},{key:"trex",value:function(t){var i=t.id,n=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)}},{key:"moof",value:function(t,i){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,i))}},{key:"mfhd",value:function(t){var i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,i)}},{key:"traf",value:function(t,i){var n=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),o=e.sdtp(t),s=e.trun(t,o.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,a,s,o)}},{key:"sdtp",value:function(t){for(var i=t.samples||[],n=i.length,r=new Uint8Array(4+n),a=0;a<n;a++){var o=i[a].flags;r[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,i){var n=t.samples||[],r=n.length,a=12+16*r,o=new Uint8Array(a);i+=8+a,o.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var s=0;s<r;s++){var u=n[s].duration,l=n[s].size,c=n[s].flags,h=n[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return e.box(e.types.trun,o)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();Tr.init();var Br=function(){function e(){tr(this,e)}return ir(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}(),Lr={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},r={};if(n.browser){r[n.browser]=!0;var a=n.majorVersion.split(".");r.version={major:parseInt(n.majorVersion,10),string:n.version},a.length>1&&(r.version.minor=parseInt(a[1],10)),a.length>2&&(r.version.build=parseInt(a[2],10))}n.platform&&(r[n.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),(r.rv||r.iemobile)&&(r.rv&&delete r.rv,n.browser="msie",r.msie=!0);r.edge&&(delete r.edge,n.browser="msedge",r.msedge=!0);r.opr&&(n.browser="opera",r.opera=!0);r.safari&&r.android&&(n.browser="android",r.android=!0);r.name=n.browser,r.platform=n.platform;for(var o in Lr)Lr.hasOwnProperty(o)&&delete Lr[o];Object.assign(Lr,r)}();var Cr=function e(t,i,n,r,a){tr(this,e),this.dts=t,this.pts=i,this.duration=n,this.originalDts=r,this.isSyncPoint=a,this.fileposition=null},Or=function(){function e(){tr(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return ir(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),Dr=(function(){function e(){tr(this,e),this._list=[]}ir(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,i=0,n=t.length-1,r=0,a=0,o=n;for(e<t[0].dts&&(i=0,a=o+1);a<=o;){if((r=a+Math.floor((o-a)/2))===n||e>=t[r].dts&&e<t[r+1].dts){i=r;break}t[r].dts<e?a=r+1:o=r-1}return this._list[i]}}])}(),function(){function e(t){tr(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return ir(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,n=0,r=0,a=i,o=0;if(e<t[0].originalBeginDts)return o=-1;for(;r<=a;){if((n=r+Math.floor((a-r)/2))===i||e>t[n].lastSample.originalDts&&e<t[n+1].originalBeginDts){o=n;break}t[n].originalBeginDts<e?r=n+1:a=n-1}return o}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=e,n=this._lastAppendLocation,r=0;-1!==n&&n<t.length&&i.originalBeginDts>=t[n].lastSample.originalDts&&(n===t.length-1||n<t.length-1&&i.originalBeginDts<t[n+1].originalBeginDts)?r=n+1:t.length>0&&(r=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,i)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&t>0;)t--,i=this._list[t].syncPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()),Mr=function(){function e(t){tr(this,e),this.TAG=this.constructor.name,this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Dr("audio"),this._videoSegmentInfoList=new Dr("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!Lr.chrome||!(Lr.version.major<50||50===Lr.version.major&&Lr.version.build<2661)),this._fillSilentAfterSeek=Lr.msedge||Lr.msie}return ir(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new xr("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var i=null;if("audio"===e)this._audioMeta=t,i=Tr.generateInitSegment(t),console.log("msg+audio",t);else{if("video"!==e)return;this._videoMeta=t,i=Tr.generateInitSegment(t),console.log("msg+video",t)}if(!this._onInitSegment)throw new xr("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:i.buffer,codec:t.codec,container:e+"/mp4"})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"_remuxAudio",value:function(e){var t=e,i=t.samples,n=void 0,r=-1,a=-1,o=!1,s=-1;if(i&&0!==i.length){var u=8+t.length,l=new Uint8Array(u);l[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(Tr.types.mdat,4);for(var c=8,h=[];i.length;){var f=i.shift(),d=f.unit,v=f.dts-this._dtsBase;if(void 0==n)if(void 0==this._audioNextDts)if(this._audioSegmentInfoList.isEmpty())n=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&(o=!0);else{var p=this._audioSegmentInfoList.getLastSampleBefore(v);if(null!=p){var m=v-(p.originalDts+p.duration);m<=3&&(m=0),n=v-(p.dts+p.duration+m)}else n=0}else n=v-this._audioNextDts;var g=v-n;if(o){var y=this._videoSegmentInfoList.getLastSegmentBefore(v);null!=y&&y.beginDts<g?(s=g-y.beginDts,g=y.beginDts):o=!1}if(-1===r&&(r=g),o){o=!1,i.unshift(f);var _=this._generateSilentAudio(g,s);if(null==_)continue;var b=_.mp4Sample,w=_.unit;h.push(b),u+=w.byteLength,(l=new Uint8Array(u))[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(Tr.types.mdat,4),l.set(w,c),c+=w.byteLength}else{var k=0;k=i.length>=1?i[0].dts-this._dtsBase-n-g:h.length>=1?h[h.length-1].duration:this._audioMeta.refSampleDuration;var S={dts:g,pts:g,cts:0,size:d.byteLength,duration:k,originalDts:v,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};h.push(S),l.set(d,c),c+=d.byteLength}}var x=h[h.length-1];a=x.dts+x.duration,this._audioNextDts=a;var A=new Or;A.beginDts=r,A.endDts=a,A.beginPts=r,A.endPts=a,A.originalBeginDts=h[0].originalDts,A.originalEndDts=x.originalDts+x.duration,A.firstSample=new Cr(h[0].dts,h[0].pts,h[0].duration,h[0].originalDts,!1),A.lastSample=new Cr(x.dts,x.pts,x.duration,x.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(A),t.samples=h,t.sequenceNumber+=t.addcoefficient;var E=Tr.moof(t,r);t.samples=[],t.length=0,this._onMediaSegment("audio",{type:"audio",data:this._mergeBoxes(E,l).buffer,sampleCount:h.length,info:A})}}},{key:"_generateSilentAudio",value:function(e,t){console.log(this.TAG,"GenerateSilentAudio: dts = "+e+", duration = "+t);var i=Br.getSilentFrame(this._audioMeta.channelCount);return null==i?(console.log(this.TAG,"Cannot generate silent aac frame for channelCount = "+this._audioMeta.channelCount),null):{unit:i,mp4Sample:{dts:e,pts:e,cts:0,size:i.byteLength,duration:t,originalDts:e,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}}}},{key:"_remuxVideo",value:function(e){var t=e,i=t.samples,n=void 0,r=-1,a=-1,o=-1,s=-1;if(i&&0!==i.length){var u=8+e.length,l=new Uint8Array(u);l[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(Tr.types.mdat,4);for(var c=8,h=[],f=new Or;i.length;){var d=i.shift(),v=d.isKeyframe,p=d.dts-this._dtsBase;if(void 0==n)if(void 0==this._videoNextDts)if(this._videoSegmentInfoList.isEmpty())n=0;else{var m=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=m){var g=p-(m.originalDts+m.duration);g<=3&&(g=0),n=p-(m.dts+m.duration+g)}else n=0}else n=p-this._videoNextDts;var y=p-n,_=d.cts,b=y+_;-1===r&&(r=y,o=b);for(var w=0;d.units.length;){var k=d.units.shift().data;l.set(k,c),c+=k.byteLength,w+=k.byteLength}var S=0;if(S=i.length>=1?i[0].dts-this._dtsBase-n-y:h.length>=1?h[h.length-1].duration:this._videoMeta.refSampleDuration,v){var x=new Cr(y,b,S,d.dts,!0);x.fileposition=d.fileposition,f.appendSyncPoint(x)}var A={dts:y,pts:b,cts:_,size:w,isKeyframe:v,duration:S,originalDts:p,flags:{isLeading:0,dependsOn:v?2:1,isDependedOn:v?1:0,hasRedundancy:0,isNonSync:v?0:1}};h.push(A)}var E=h[h.length-1];if(a=E.dts+E.duration,s=E.pts+E.duration,this._videoNextDts=a,f.beginDts=r,f.endDts=a,f.beginPts=o,f.endPts=s,f.originalBeginDts=h[0].originalDts,f.originalEndDts=E.originalDts+E.duration,f.firstSample=new Cr(h[0].dts,h[0].pts,h[0].duration,h[0].originalDts,h[0].isKeyframe),f.lastSample=new Cr(E.dts,E.pts,E.duration,E.originalDts,E.isKeyframe),this._isLive||this._videoSegmentInfoList.append(f),t.samples=h,t.sequenceNumber+=t.addcoefficient,this._forceFirstIDR){var T=h[0].flags;T.dependsOn=2,T.isNonSync=0}var B=Tr.moof(t,r);t.samples=[],t.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(B,l).buffer,sampleCount:h.length,info:f})}}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}(),Rr=function(e){function t(e){tr(this,t);var i=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._config={_isLive:!1},i._config=Object.assign(i._config,e),i.onInitSegment=null,i.onMediaSegment=null,i.onMediaInfo=null,i.seekCallBack=null,i.loadmetadata=!1,i.ftyp_moov=null,i.metaSuccRun=!1,i.metas=[],i.parseChunk=null,i.hasVideo=!1,i.hasAudio=!1,i._error=null,i._pendingResolveSeekPoint=-1,i._tempBaseTime=0,i.setflvBase=i.setflvBasefrist,Ar._onTrackMetadata=i.Metadata.bind(i),Ar._onMediaInfo=i.metaSucc.bind(i),Ar._onDataAvailable=i.onDataAvailable.bind(i),Ar._onError=i.error.bind(i),i.m4mof=new Mr(i._config),i.m4mof.onMediaSegment=i.onMdiaSegment.bind(i),i}return rr(t,Xn),ir(t,[{key:"seek",value:function(e){this.setflvBase=this.setflvBasefrist,void 0!=e&&0!=e||(e=0,this._pendingResolveSeekPoint=-1),this._tempBaseTime!=e&&(this._tempBaseTime=e,Ar._timestampBase=e,this.m4mof.seek(e),this.m4mof.insertDiscontinuity(),this._pendingResolveSeekPoint=e)}},{key:"setflvBasefrist",value:function(e,t){var i=0;try{i=Er.setFlv(new Uint8Array(e))}catch(e){this.error(e)}if(18!=Er.arrTag[0].type&&this.error(new xr("without metadata tag")),Er.arrTag.length>0){Ar.hasAudio=this.hasAudio=Er._hasAudio,Ar.hasVideo=this.hasVideo=Er._hasVideo,0!=this._tempBaseTime&&this._tempBaseTime==Er.arrTag[0].getTime()&&(Ar._timestampBase=0);try{Ar.moofTag(Er.arrTag)}catch(e){this.error(e)}this.setflvBase=this.setflvBaseUsually}return i}},{key:"setflvBaseUsually",value:function(e,t){var i=0;try{i=Er.setFlv(new Uint8Array(e))}catch(e){this.error(e)}if(Er.arrTag.length>0)try{Ar.moofTag(Er.arrTag)}catch(e){this.error(e)}return i}},{key:"onMdiaSegment",value:function(e,t){if(this.onMediaSegment&&this.onMediaSegment(new Uint8Array(t.data)),-1!=this._pendingResolveSeekPoint&&"video"==e){var i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=-1,this.seekCallBack&&this.seekCallBack(i)}}},{key:"Metadata",value:function(e,t){switch(e){case"video":if(this.metas.push(t),this.m4mof._videoMeta=t,this.hasVideo&&!this.hasAudio)return void this.metaSucc();break;case"audio":if(this.metas.push(t),this.m4mof._audioMeta=t,!this.hasVideo&&this.hasAudio)return void this.metaSucc()}this.hasVideo&&this.hasAudio&&this.metas.length>1&&this.metaSucc()}},{key:"metaSucc",value:function(e){this.onMediaInfo&&this.onMediaInfo(e||Ar._mediaInfo,{hasAudio:this.hasAudio,hasVideo:this.hasVideo}),0!=this.metas.length?e||(this.ftyp_moov=Tr.generateInitSegment(this.metas),this.onInitSegment&&0==this.loadmetadata&&(this.onInitSegment(this.ftyp_moov),this.loadmetadata=!0)):this.metaSuccRun=!0}},{key:"onDataAvailable",value:function(e,t){try{this.m4mof.remux(e,t)}catch(e){this.error(e)}}},{key:"setflv",value:function(e,t){return this.setflvBase(e,t)}},{key:"setflvloc",value:function(e){Er.setFlv(new Uint8Array(e));if(Er.arrTag.length>0)return Er.arrTag}},{key:"error",value:function(e){this._error&&this._error(e)}}]),t}(),Ir=function(e){function t(e){tr(this,t);var i=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.f2m=new Rr(e),i.f2m._error=i.error,i._onInitSegment=null,i._onMediaSegment=null,i._onMediaInfo=null,i._seekCallBack=null,i}return rr(t,Xn),ir(t,[{key:"error",value:function(e){this.emit("error",e.type)}},{key:"seek",value:function(e){this.f2m.seek(e)}},{key:"setflv",value:function(e){return this.f2m.setflv(e,0)}},{key:"setflvloc",value:function(e){return this.f2m.setflvloc(e)}},{key:"onInitSegment",set:function(e){this._onInitSegment=e,this.f2m.onInitSegment=e}},{key:"onMediaSegment",set:function(e){this._onMediaSegment=e,this.f2m.onMediaSegment=e}},{key:"onMediaInfo",set:function(e){this._onMediaInfo=e,this.f2m.onMediaInfo=e}},{key:"seekCallBack",set:function(e){this._seekCallBack=e,this.f2m.seekCallBack=e}}]),t}(),Ur=function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.config={},n.tag="transmuxer",n.loader=null,n.CPU=null,n.keyframePoint=!1,n.w=null,Object.assign(n.config,i),n.config.webWorker&&(n.w=gr("./transmuxer-worker"),n.w.postMessage({cmd:"init"}),n.w.addEventListener("message",function(e){n.parseCallback(e.data)})),n}return rr(t,Xn),ir(t,[{key:"loadSource",value:function(){this.config.webWorker?this.w.postMessage({cmd:"loadSource"}):(this.loader=new fr(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.open())}},{key:"arrivalDataCallback",value:function(e,t,i){return this.CPU||(this.CPU=new Ir,this.CPU.onInitSegment=this.onRemuxerInitSegmentArrival.bind(this),this.CPU.onMediaSegment=this.onRemuxerMediaSegmentArrival.bind(this),this.CPU.onError=this.onCPUError.bind(this),this.CPU.onMediaInfo=this.onMediaInfo.bind(this),this.CPU.on("error",function(e){this.emit("f2m",e.data)})),i&&(this.keyframePoint=!0,this.CPU.seek(i)),this.CPU.setflv(e)}},{key:"parseCallback",value:function(e){switch(e.cmd){case"pipeCallback":e.source;break;case"mediaSegmentInit":this.emit("mediaSegmentInit",e.source);break;case"mediaSegment":this.emit("mediaSegment",e.source);break;case"mediainfo":this.emit("mediainfo",e.source)}}},{key:"onDemuxError",value:function(e,t){Ei.error(this.tag,"DemuxError: type = "+e+", info = "+t),this.emit("DemuxError",e,t)}},{key:"onMediaInfo",value:function(e){this.mediaInfo=e,this.emit("mediaInfo",e)}},{key:"onRemuxerInitSegmentArrival",value:function(e){this.emit("mediaSegmentInit",e)}},{key:"onRemuxerMediaSegmentArrival",value:function(e){this.emit("mediaSegment",e)}},{key:"onCPUError",value:function(e){this.emit("ERROR",e.data)}},{key:"getMediaInfo",value:function(){return this.mediaInfo}},{key:"pause",value:function(){this.loader.pause()}},{key:"resume",value:function(){this.loader.resume()}},{key:"isSeekable",value:function(){return this.mediaInfo.hasKeyframesIndex}},{key:"seek",value:function(e){if(!this.isSeekable())return this.emit("ERROR","这个flv视频不支持seek"),!1;this.loader=new fr(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.seek(e.keyframePoint,!1,e.keyframetime)}},{key:"refresh",value:function(){this.pause(),this.loader=new fr(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.open()}},{key:"destroy",value:function(){this.loader.destroy(),this.loader=null,this.CPU=null}},{key:"getNearlestKeyframe",value:function(e){if(this.mediaInfo&&this.mediaInfo.keyframesIndex){var t=this.mediaInfo.keyframesIndex.times,i=this.mediaInfo.keyframesIndex.filepositions;return function e(n,r){var a=n.length,o=Math.floor(a/2);if(1===a){var s=t.indexOf(n[0]);return{keyframetime:n[0],keyframePoint:i[s]}}if(n[o]>r)return e(n.slice(0,o),r);if(n[o]<r)return e(n.slice(o),r);var u=t.indexOf(n[0]);return{keyframetime:n[0],keyframePoint:i[u]}}(t,e)}return 0}}]),t}(),Pr={isLive:!1,box:"flv",prestrain:30,alwaysSeekKeyframe:!0,lazyLoadMaxDuration:120,lazyLoadRecoverDuration:30,lockInternalProperty:!1,debug:!0,webWorker:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:30,autoCleanupMinBackwardDuration:30};return function(e){function t(e,i){tr(this,t);var n=ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.tag="FLV-player",n.video=e,n.box="flv",n.timer=null,n.config=h({},Pr,i),n.requestSetTime=!1,n.bindEvents(),n.attachMedia(),n}return rr(t,Xn),ir(t,null,[{key:"isSupport",value:function(){var e=(new Ti).getBrowser();return!("Safari"===e.name&&parseInt(e.major)<10)&&!(!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640020,mp4a.40.2"'))}},{key:"version",get:function(){return"1.1.2"}}]),ir(t,[{key:"internalPropertyHandle",value:function(){if(Object.getOwnPropertyDescriptor){var e=this,t=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");Object.defineProperty(this.video,"currentTime",{get:function(){return t.get.call(e.video)},set:function(i){if(e.currentTimeLock)return t.set.call(e.video,i);throw new Error("can not set currentTime by youself")}})}}},{key:"bindEvents",value:function(){var e=this;this.video&&this.video.addEventListener("canplay",function(){e.config.isLive&&e.video.play(),e.config.lockInternalProperty&&e.internalPropertyHandle()})}},{key:"attachMedia",value:function(){var e=this;this.mediaSource=new or(this.video,this.config),this.mediaSource.on("source_open",function(){}),this.mediaSource.on("bufferFull",function(){e.pauseTransmuxer()}),this.mediaSource.on("updateend",function(){e.onmseUpdateEnd()})}},{key:"load",value:function(e){var t=this;e&&(this.config.src=e),this.transmuxer=new Ur(this.mediaSource,this.config),this.transmuxer.on("mediaSegment",function(e){t.mediaSource.emit("mediaSegment",e.data)}),this.transmuxer.on("mediaSegmentInit",function(e){t.mediaSource.emit("mediaSegmentInit",e.data)}),this.transmuxer.on("error",function(e){t.emit("error",e.data)}),this.transmuxer.on("mediaInfo",function(e){t.mediaInfo||(t.mediaInfo=e,t.emit("mediaInfo",e),t.mediaSource.init(e),t.video.src=URL.createObjectURL(t.mediaSource.mediaSource),t.video.addEventListener("seeking",f(t._seek.bind(t),200,{leading:!1})))}),this.transmuxer.loadSource()}},{key:"isTimeinBuffered",value:function(e){for(var t=this.video.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(e>=n&&e<r)return!0}return!1}},{key:"getCurrentBufferEnd",value:function(){for(var e=this.video.buffered,t=this.video.currentTime,i=0;i<e.length;i++){var n=e.start(i),r=e.end(i);if(n<=t&&t<r)return r}}},{key:"_seek",value:function(e){this.currentTimeLock=!0;var t=e&&!isNaN(e)?e:this.video.currentTime;if(this.requestSetTime)return this.requestSetTime=!1,void(this.currentTimeLock=!1);if(this.isTimeinBuffered(t)){if(this.config.alwaysSeekKeyframe){var i=this.transmuxer.getNearlestKeyframe(Math.floor(1e3*t));i&&(this.requestSetTime=!0,this.video.currentTime=i.keyframetime/1e3)}}else{Ei.verbose(this.tag,"do seek"),this.transmuxer.pause();var n=this.transmuxer.getNearlestKeyframe(Math.floor(1e3*t));t=n.keyframetime/1e3,this.transmuxer.seek(n),this.mediaSource.seek(t),this.requestSetTime=!0,this.video.currentTime=t,window.clearInterval(this.timer),this.timer=null}return this.currentTimeLock=!1,t}},{key:"onmseUpdateEnd",value:function(){var e=this;setTimeout(function(){e.config.isLive||e.getCurrentBufferEnd()>=e.video.currentTime+e.config.lazyLoadMaxDuration&&null===e.timer&&(Ei.verbose(e.tag,"Maximum buffering duration exceeded, suspend transmuxing task"),e.pauseTransmuxer())},10)}},{key:"heartbeat",value:function(){for(var e=this.video.currentTime,t=this.video.buffered,i=!1,n=0;n<t.length;n++){var r=t.start(n),a=t.end(n);if(e>=r&&e<a){e>=a-this.config.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this.timer),this.timer=null,Ei.verbose(this.tag,"Continue loading from paused position"),this.transmuxer.resume())}},{key:"pauseTransmuxer",value:function(){this.transmuxer.pause(),this.timer||(this.timer=setInterval(this.heartbeat.bind(this),1e3))}},{key:"resume",value:function(){}},{key:"destroy",value:function(){this.video&&(this.video.src="",this.video.removeAttribute("src"),this.transmuxer.destroy(),this.transmuxer=null,this.mediaSource.destroy(),this.mediaSource=null)}},{key:"seek",value:function(e){return this._seek(e)}},{key:"play",value:function(){return this.video.play()}},{key:"pause",value:function(){return this.video.pause()}},{key:"refresh",value:function(){this.transmuxer.refresh()}}]),t}()});
