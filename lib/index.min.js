!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.chimeeKernelFlv=t()}(this,function(){"use strict";function e(e){return e&&e.__esModule?e.default:e}function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e){return void 0===e||null===e}function i(e){return Array.isArray(e)}function r(e){return"function"==typeof e}function a(e){return Object(e)===e&&"[object Object]"===String(e)&&!r(e)&&!i(e)}function o(e){return"number"==typeof e}function s(e){return"string"==typeof e||e instanceof String}function u(e){return"boolean"==typeof e}function l(e){return n(e)||u(e)||s(e)||o(e)}function c(e,t){if(!s(e))throw new TypeError("Log's method only acccept string as argument");return s(t)?"["+(e=En.FORCE_GLOBAL_TAG?En.GLOBAL_TAG:e||En.GLOBAL_TAG)+"] > "+t:"["+En.GLOBAL_TAG+"] > "+e}function h(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length<2)throw new Error("deepAssign accept two and more argument");for(var i=t.length-1;i>-1;i--)if(l(t[i]))throw new TypeError("deepAssign only accept non primitive type");var r=t.shift();return t.forEach(function(e){return Xn(e,r)}),r}function f(e,t,n,i){var r=void 0,a=void 0,o=void 0,s=null,u=0;n||(n={});var l=function(){u=!1===n.leading?0:new Date-0,s=null,o=e.apply(r,a),s||(r=a=null)};return t=t||0,function(){var c=new Date;u||!1!==n.leading||(u=c);var h=t-(c-u);return r=i||this,a=arguments,h<=0||h>t?(s&&(clearTimeout(s),s=null),u=c,o=e.apply(r,a),s||(r=a=null)):s||!1===n.trailing||(s=setTimeout(l,h)),o}}function d(e,t){var n=e.__evt_id;n||(Object.defineProperty(e,"__evt_id",{writable:!0,enumerable:!1,configurable:!0}),n=e.__evt_id=++Hi.count);var i=n+"_"+t,r=Hi[i];return r||(r=Hi[i]=[]),r}function p(e,t,n){var i=qi(null);i.type=t,i.target=e,n&&Vi(i,a(n)?n:{data:n}),d(e,t).forEach(function(t){(t[1]||t[0]).apply(e,[i])})}function m(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];r(i)&&!a&&(a=i,i=void 0);var o=[n,void 0,i];i&&!a&&(a=function(){y(e,t,n,i);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];n.apply(e,a)}),a&&(o[1]=a),d(e,t).push(o)}function y(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=d(e,t);if(n||i){var a=-1,o=void 0;return r.find(function(e,t){if((!n||e[0]===n)&&(!i||e[2]))return a=t,o=e[1],!0}),-1!==a&&r.splice(a,1),o}r.length=0}function g(e,t){var n=e.__evt_id;n||(Object.defineProperty(e,"__evt_id",{writable:!0,enumerable:!1,configurable:!0}),n=e.__evt_id=++Wi.count);var i=n+"_"+t,r=Wi[i];return r||(r=Wi[i]=[]),r}function _(e,t,n){var i=qi(null);i.type=t,i.target=e,n&&Vi(i,a(n)?n:{data:n}),g(e,t).forEach(function(t){(t[1]||t[0]).apply(e,[i])})}function b(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];r(i)&&!a&&(a=i,i=void 0);var o=[n,void 0,i];i&&!a&&(a=function(){S(e,t,n,i);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];n.apply(e,a)}),a&&(o[1]=a),g(e,t).push(o)}function S(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=g(e,t);if(n||i){var a=-1,o=void 0;return r.find(function(e,t){if((!n||e[0]===n)&&(!i||e[2]))return a=t,o=e[1],!0}),-1!==a&&r.splice(a,1),o}r.length=0}function k(e){return Wn(e)}function w(e,t){return e.getAttribute(t)}function A(e,t,n){void 0===n?e.removeAttribute(t):e.setAttribute(t,n)}function x(e,t){if(t&&(t=t.trim())){var n=t.split(/\s+/);if(e.classList)n.forEach(function(t){return e.classList.add(t)});else{var i=" "+(e.className||"")+" ";n.forEach(function(e){-1===i.indexOf(" "+e+" ")&&(i+=" "+e)}),e.className=i.trim()}}}function E(e,t){if(t&&(t=t.trim())){var n=t.split(/\s+/);if(e.classList)n.forEach(function(t){return e.classList.remove(t)});else{var i=" "+e.className+" ";n.forEach(function(e){for(var t=" "+e+" ";-1!==i.indexOf(t);)i=i.replace(t," ")}),e.className=i.trim()}}}function B(e,t){return new RegExp("(?:^|\\s)"+t+"(?=\\s|$)").test(e.className)}function L(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i){var a=S(e,t+"_once",n);a&&(n=a)}e.removeEventListener(t,n,r)}function D(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i){var a=n;b(e,t+"_once",a,n=function(){for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];a.apply(this,s),L(e,t,n,i,r)})}e.addEventListener(t,n,r)}function T(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(n){var r=U(n.srcElement,e,!0),a=R(t,e,!0).find(function(e){return r.find(function(t){return e===t})});a&&i.apply(a,arguments)};b(e,n+"_delegate_"+t,i,a),e.addEventListener(n,a,r)}function C(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=S(e,n+"_delegate_"+t,i);a&&e.removeEventListener(n,a,r)}function O(e,t){return(e.currentStyle||document.defaultView.getComputedStyle(e,null))[t]||e.style[t]}function M(e,t,n){if(a(t))for(var i in t)M(e,i,t[i]);else e.style[t]=n}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=arguments[2],i=t.querySelectorAll(e);return n?Wn(i):i}function I(e){e.parentNode.removeChild(e)}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2],i=arguments[3],r=[];for(n&&r.push(e);e&&e.parentNode!==t;)(e=e.parentNode)&&r.push(e);return i&&r.push(t),r}function P(e,t){return e.constructor===Yi?e:new Yi(e,t)}function j(e){for(var t=[],n=e,i=0,r=e.length;i<r;)if(n[i]<128)t.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(F(n,i,1)){var a=(31&n[i])<<6|63&n[i+1];if(a>=128){t.push(String.fromCharCode(65535&a)),i+=2;continue}}}else if(n[i]<240){if(F(n,i,2)){var o=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),i+=3;continue}}}else if(n[i]<248&&F(n,i,3)){var s=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(s>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}function F(e,t,n){var i=e;if(t+n<i.length){for(;n--;)if(128!=(192&i[++t]))return!1;return!0}return!1}var N=e(t(function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}})),V=t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),z=t(function(e){var t=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=t)}),G=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},q=function(e,t,n){if(G(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}},H=function(e){return"object"==typeof e?null!==e:"function"==typeof e},K=function(e){if(!H(e))throw TypeError(e+" is not an object!");return e},W=function(e){try{return!!e()}catch(e){return!0}},X=!W(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),J=V.document,Z=H(J)&&H(J.createElement),Y=function(e){return Z?J.createElement(e):{}},$=!X&&!W(function(){return 7!=Object.defineProperty(Y("div"),"a",{get:function(){return 7}}).a}),Q=function(e,t){if(!H(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!H(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!H(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!H(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")},ee=Object.defineProperty,te={f:X?Object.defineProperty:function(e,t,n){if(K(e),t=Q(t,!0),K(n),$)try{return ee(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},ne=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ie=X?function(e,t,n){return te.f(e,t,ne(1,n))}:function(e,t,n){return e[t]=n,e},re=function(e,t,n){var i,r,a,o=e&re.F,s=e&re.G,u=e&re.S,l=e&re.P,c=e&re.B,h=e&re.W,f=s?z:z[t]||(z[t]={}),d=f.prototype,v=s?V:u?V[t]:(V[t]||{}).prototype;s&&(n=t);for(i in n)(r=!o&&v&&void 0!==v[i])&&i in f||(a=r?v[i]:n[i],f[i]=s&&"function"!=typeof v[i]?n[i]:c&&r?q(a,V):h&&v[i]==a?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(a):l&&"function"==typeof a?q(Function.call,a):a,l&&((f.virtual||(f.virtual={}))[i]=a,e&re.R&&d&&!d[i]&&ie(d,i,a)))};re.F=1,re.G=2,re.S=4,re.P=8,re.B=16,re.W=32,re.U=64,re.R=128;var ae=re;ae(ae.S+ae.F*!X,"Object",{defineProperty:te.f});var oe=z.Object,se=function(e,t,n){return oe.defineProperty(e,t,n)},ue=t(function(e){e.exports={default:se,__esModule:!0}}),le=e(t(function(e,t){t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(ue);t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,n.default)(e,r.key,r)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()})),ce=Math.ceil,he=Math.floor,fe=function(e){return isNaN(e=+e)?0:(e>0?he:ce)(e)},de=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},ve=ie,pe={}.hasOwnProperty,me=function(e,t){return pe.call(e,t)},ye={},ge={}.toString,_e=function(e){return ge.call(e).slice(8,-1)},be=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==_e(e)?e.split(""):Object(e)},Se=function(e){return be(de(e))},ke=Math.min,we=function(e){return e>0?ke(fe(e),9007199254740991):0},Ae=Math.max,xe=Math.min,Ee=function(e,t){return(e=fe(e))<0?Ae(e+t,0):xe(e,t)},Be=V["__core-js_shared__"]||(V["__core-js_shared__"]={}),Le=function(e){return Be[e]||(Be[e]={})},De=0,Te=Math.random(),Ce=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++De+Te).toString(36))},Oe=Le("keys"),Me=function(e){return Oe[e]||(Oe[e]=Ce(e))},Re=function(e){return function(t,n,i){var r,a=Se(t),o=we(a.length),s=Ee(i,o);if(e&&n!=n){for(;o>s;)if((r=a[s++])!=r)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}}(!1),Ie=Me("IE_PROTO"),Ue=function(e,t){var n,i=Se(e),r=0,a=[];for(n in i)n!=Ie&&me(i,n)&&a.push(n);for(;t.length>r;)me(i,n=t[r++])&&(~Re(a,n)||a.push(n));return a},Pe="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),je=Object.keys||function(e){return Ue(e,Pe)},Fe=X?Object.defineProperties:function(e,t){K(e);for(var n,i=je(t),r=i.length,a=0;r>a;)te.f(e,n=i[a++],t[n]);return e},Ne=V.document&&document.documentElement,Ve=Me("IE_PROTO"),ze=function(){},Ge=function(){var e,t=Y("iframe"),n=Pe.length;for(t.style.display="none",Ne.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ge=e.F;n--;)delete Ge.prototype[Pe[n]];return Ge()},qe=Object.create||function(e,t){var n;return null!==e?(ze.prototype=K(e),n=new ze,ze.prototype=null,n[Ve]=e):n=Ge(),void 0===t?n:Fe(n,t)},He=t(function(e){var t=Le("wks"),n=V.Symbol,i="function"==typeof n;(e.exports=function(e){return t[e]||(t[e]=i&&n[e]||(i?n:Ce)("Symbol."+e))}).store=t}),Ke=te.f,We=He("toStringTag"),Xe=function(e,t,n){e&&!me(e=n?e:e.prototype,We)&&Ke(e,We,{configurable:!0,value:t})},Je={};ie(Je,He("iterator"),function(){return this});var Ze=function(e,t,n){e.prototype=qe(Je,{next:ne(1,n)}),Xe(e,t+" Iterator")},Ye=function(e){return Object(de(e))},$e=Me("IE_PROTO"),Qe=Object.prototype,et=Object.getPrototypeOf||function(e){return e=Ye(e),me(e,$e)?e[$e]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Qe:null},tt=He("iterator"),nt=!([].keys&&"next"in[].keys()),it=function(){return this},rt=function(e,t,n,i,r,a,o){Ze(n,t,i);var s,u,l,c=function(e){if(!nt&&e in v)return v[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},h=t+" Iterator",f="values"==r,d=!1,v=e.prototype,p=v[tt]||v["@@iterator"]||r&&v[r],m=p||c(r),y=r?f?c("entries"):m:void 0,g="Array"==t?v.entries||p:p;if(g&&(l=et(g.call(new e)))!==Object.prototype&&Xe(l,h,!0),f&&p&&"values"!==p.name&&(d=!0,m=function(){return p.call(this)}),o&&(nt||d||!v[tt])&&ie(v,tt,m),ye[t]=m,ye[h]=it,r)if(s={values:f?m:c("values"),keys:a?m:c("keys"),entries:y},o)for(u in s)u in v||ve(v,u,s[u]);else ae(ae.P+ae.F*(nt||d),t,s);return s},at=function(e){return function(t,n){var i,r,a=String(de(t)),o=fe(n),s=a.length;return o<0||o>=s?e?"":void 0:(i=a.charCodeAt(o))<55296||i>56319||o+1===s||(r=a.charCodeAt(o+1))<56320||r>57343?e?a.charAt(o):i:e?a.slice(o,o+2):r-56320+(i-55296<<10)+65536}}(!0);rt(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=at(t,n),this._i+=e.length,{value:e,done:!1})});var ot=function(){},st=function(e,t){return{value:t,done:!!e}};rt(Array,"Array",function(e,t){this._t=Se(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,st(1)):"keys"==t?st(0,n):"values"==t?st(0,e[n]):st(0,[n,e[n]])},"values");ye.Arguments=ye.Array,ot(),ot(),ot();for(var ut=He("toStringTag"),lt=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],ct=0;ct<5;ct++){var ht=lt[ct],ft=V[ht],dt=ft&&ft.prototype;dt&&!dt[ut]&&ie(dt,ut,ht),ye[ht]=ye.Array}var vt={f:He},pt=vt.f("iterator"),mt=t(function(e){e.exports={default:pt,__esModule:!0}}),yt=t(function(e){var t=Ce("meta"),n=te.f,i=0,r=Object.isExtensible||function(){return!0},a=!W(function(){return r(Object.preventExtensions({}))}),o=function(e){n(e,t,{value:{i:"O"+ ++i,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,n){if(!H(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!me(e,t)){if(!r(e))return"F";if(!n)return"E";o(e)}return e[t].i},getWeak:function(e,n){if(!me(e,t)){if(!r(e))return!0;if(!n)return!1;o(e)}return e[t].w},onFreeze:function(e){return a&&s.NEED&&r(e)&&!me(e,t)&&o(e),e}}}),gt=te.f,_t=function(e){var t=z.Symbol||(z.Symbol={});"_"==e.charAt(0)||e in t||gt(t,e,{value:vt.f(e)})},bt=function(e,t){for(var n,i=Se(e),r=je(i),a=r.length,o=0;a>o;)if(i[n=r[o++]]===t)return n},St={f:Object.getOwnPropertySymbols},kt={f:{}.propertyIsEnumerable},wt=function(e){var t=je(e),n=St.f;if(n)for(var i,r=n(e),a=kt.f,o=0;r.length>o;)a.call(e,i=r[o++])&&t.push(i);return t},At=Array.isArray||function(e){return"Array"==_e(e)},xt=Pe.concat("length","prototype"),Et={f:Object.getOwnPropertyNames||function(e){return Ue(e,xt)}},Bt=Et.f,Lt={}.toString,Dt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Tt=function(e){try{return Bt(e)}catch(e){return Dt.slice()}},Ct={f:function(e){return Dt&&"[object Window]"==Lt.call(e)?Tt(e):Bt(Se(e))}},Ot=Object.getOwnPropertyDescriptor,Mt={f:X?Ot:function(e,t){if(e=Se(e),t=Q(t,!0),$)try{return Ot(e,t)}catch(e){}if(me(e,t))return ne(!kt.f.call(e,t),e[t])}},Rt=yt.KEY,It=Mt.f,Ut=te.f,Pt=Ct.f,jt=V.Symbol,Ft=V.JSON,Nt=Ft&&Ft.stringify,Vt=He("_hidden"),zt=He("toPrimitive"),Gt={}.propertyIsEnumerable,qt=Le("symbol-registry"),Ht=Le("symbols"),Kt=Le("op-symbols"),Wt=Object.prototype,Xt="function"==typeof jt,Jt=V.QObject,Zt=!Jt||!Jt.prototype||!Jt.prototype.findChild,Yt=X&&W(function(){return 7!=qe(Ut({},"a",{get:function(){return Ut(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=It(Wt,t);i&&delete Wt[t],Ut(e,t,n),i&&e!==Wt&&Ut(Wt,t,i)}:Ut,$t=function(e){var t=Ht[e]=qe(jt.prototype);return t._k=e,t},Qt=Xt&&"symbol"==typeof jt.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof jt},en=function(e,t,n){return e===Wt&&en(Kt,t,n),K(e),t=Q(t,!0),K(n),me(Ht,t)?(n.enumerable?(me(e,Vt)&&e[Vt][t]&&(e[Vt][t]=!1),n=qe(n,{enumerable:ne(0,!1)})):(me(e,Vt)||Ut(e,Vt,ne(1,{})),e[Vt][t]=!0),Yt(e,t,n)):Ut(e,t,n)},tn=function(e,t){K(e);for(var n,i=wt(t=Se(t)),r=0,a=i.length;a>r;)en(e,n=i[r++],t[n]);return e},nn=function(e){var t=Gt.call(this,e=Q(e,!0));return!(this===Wt&&me(Ht,e)&&!me(Kt,e))&&(!(t||!me(this,e)||!me(Ht,e)||me(this,Vt)&&this[Vt][e])||t)},rn=function(e,t){if(e=Se(e),t=Q(t,!0),e!==Wt||!me(Ht,t)||me(Kt,t)){var n=It(e,t);return!n||!me(Ht,t)||me(e,Vt)&&e[Vt][t]||(n.enumerable=!0),n}},an=function(e){for(var t,n=Pt(Se(e)),i=[],r=0;n.length>r;)me(Ht,t=n[r++])||t==Vt||t==Rt||i.push(t);return i},on=function(e){for(var t,n=e===Wt,i=Pt(n?Kt:Se(e)),r=[],a=0;i.length>a;)!me(Ht,t=i[a++])||n&&!me(Wt,t)||r.push(Ht[t]);return r};Xt||(ve((jt=function(){if(this instanceof jt)throw TypeError("Symbol is not a constructor!");var e=Ce(arguments.length>0?arguments[0]:void 0),t=function(n){this===Wt&&t.call(Kt,n),me(this,Vt)&&me(this[Vt],e)&&(this[Vt][e]=!1),Yt(this,e,ne(1,n))};return X&&Zt&&Yt(Wt,e,{configurable:!0,set:t}),$t(e)}).prototype,"toString",function(){return this._k}),Mt.f=rn,te.f=en,Et.f=Ct.f=an,kt.f=nn,St.f=on,vt.f=function(e){return $t(He(e))}),ae(ae.G+ae.W+ae.F*!Xt,{Symbol:jt});for(var sn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),un=0;sn.length>un;)He(sn[un++]);for(var sn=je(He.store),un=0;sn.length>un;)_t(sn[un++]);ae(ae.S+ae.F*!Xt,"Symbol",{for:function(e){return me(qt,e+="")?qt[e]:qt[e]=jt(e)},keyFor:function(e){if(Qt(e))return bt(qt,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){Zt=!0},useSimple:function(){Zt=!1}}),ae(ae.S+ae.F*!Xt,"Object",{create:function(e,t){return void 0===t?qe(e):tn(qe(e),t)},defineProperty:en,defineProperties:tn,getOwnPropertyDescriptor:rn,getOwnPropertyNames:an,getOwnPropertySymbols:on}),Ft&&ae(ae.S+ae.F*(!Xt||W(function(){var e=jt();return"[null]"!=Nt([e])||"{}"!=Nt({a:e})||"{}"!=Nt(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!Qt(e)){for(var t,n,i=[e],r=1;arguments.length>r;)i.push(arguments[r++]);return"function"==typeof(t=i[1])&&(n=t),!n&&At(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!Qt(t))return t}),i[1]=t,Nt.apply(Ft,i)}}}),jt.prototype[zt]||ie(jt.prototype,zt,jt.prototype.valueOf),Xe(jt,"Symbol"),Xe(Math,"Math",!0),Xe(V.JSON,"JSON",!0),_t("asyncIterator"),_t("observable");var ln=z.Symbol,cn=t(function(e){e.exports={default:ln,__esModule:!0}}),hn=e(t(function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(mt),r=n(cn),a="function"==typeof r.default&&"symbol"==typeof i.default?function(e){return typeof e}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":typeof e};t.default="function"==typeof r.default&&"symbol"===a(i.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":void 0===e?"undefined":a(e)}}));!function(e,t){var n=(z.Object||{})[e]||Object[e],i={};i[e]=t(n),ae(ae.S+ae.F*W(function(){n(1)}),"Object",i)}("keys",function(){return function(e){return je(Ye(e))}});var fn=z.Object.keys,dn=(t(function(e){e.exports={default:fn,__esModule:!0}}),Math.floor);ae(ae.S,"Number",{isInteger:function(e){return!H(e)&&isFinite(e)&&dn(e)===e}});var vn=z.Number.isInteger,pn=(t(function(e){e.exports={default:vn,__esModule:!0}}),"\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"),mn="["+pn+"]",yn=RegExp("^"+mn+mn+"*"),gn=RegExp(mn+mn+"*$"),_n=function(e,t,n){var i={},r=W(function(){return!!pn[e]()||"​"!="​"[e]()}),a=i[e]=r?t(bn):pn[e];n&&(i[n]=a),ae(ae.P+ae.F*r,"String",i)},bn=_n.trim=function(e,t){return e=String(de(e)),1&t&&(e=e.replace(yn,"")),2&t&&(e=e.replace(gn,"")),e},Sn=_n,kn=V.parseFloat,wn=Sn.trim,An=1/kn(pn+"-0")!=-1/0?function(e){var t=wn(String(e),3),n=kn(t);return 0===n&&"-"==t.charAt(0)?-0:n}:kn;ae(ae.S+ae.F*(Number.parseFloat!=An),"Number",{parseFloat:An});var xn=parseFloat,En=(t(function(e){e.exports={default:xn,__esModule:!0}}),function(){function e(){N(this,e)}return le(e,null,[{key:"error",value:function(t,n){e.ENABLE_ERROR&&(console.error||console.warn||console.log)(c(t,n))}},{key:"info",value:function(t,n){e.ENABLE_INFO&&(console.info||console.log)(c(t,n))}},{key:"warn",value:function(t,n){e.ENABLE_WARN&&(console.warn||console.log)(c(t,n))}},{key:"debug",value:function(t,n){e.ENABLE_DEBUG&&(console.debug||console.log)(c(t,n))}},{key:"verbose",value:function(t,n){e.ENABLE_VERBOSE&&console.log(c(t,n))}}]),e}());En.GLOBAL_TAG="chimee",En.FORCE_GLOBAL_TAG=!1,En.ENABLE_ERROR=!0,En.ENABLE_INFO=!0,En.ENABLE_WARN=!0,En.ENABLE_DEBUG=!0,En.ENABLE_VERBOSE=!0;var Bn=function(e,t,n,i){try{return i?t(K(n)[0],n[1]):t(n)}catch(t){var r=e.return;throw void 0!==r&&K(r.call(e)),t}},Ln=He("iterator"),Dn=Array.prototype,Tn=function(e){return void 0!==e&&(ye.Array===e||Dn[Ln]===e)},Cn=function(e,t,n){t in e?te.f(e,t,ne(0,n)):e[t]=n},On=He("toStringTag"),Mn="Arguments"==_e(function(){return arguments}()),Rn=function(e,t){try{return e[t]}catch(e){}},In=function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=Rn(t=Object(e),On))?n:Mn?_e(t):"Object"==(i=_e(t))&&"function"==typeof t.callee?"Arguments":i},Un=He("iterator"),Pn=z.getIteratorMethod=function(e){if(void 0!=e)return e[Un]||e["@@iterator"]||ye[In(e)]},jn=He("iterator"),Fn=!1;try{var Nn=[7][jn]();Nn.return=function(){Fn=!0},Array.from(Nn,function(){throw 2})}catch(e){}var Vn=function(e,t){if(!t&&!Fn)return!1;var n=!1;try{var i=[7],r=i[jn]();r.next=function(){return{done:n=!0}},i[jn]=function(){return r},e(i)}catch(e){}return n};ae(ae.S+ae.F*!Vn(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,r,a=Ye(e),o="function"==typeof this?this:Array,s=arguments.length,u=s>1?arguments[1]:void 0,l=void 0!==u,c=0,h=Pn(a);if(l&&(u=q(u,s>2?arguments[2]:void 0,2)),void 0==h||o==Array&&Tn(h))for(n=new o(t=we(a.length));t>c;c++)Cn(n,c,l?u(a[c],c):a[c]);else for(r=h.call(a),n=new o;!(i=r.next()).done;c++)Cn(n,c,l?Bn(r,u,[i.value,c],!0):i.value);return n.length=c,n}});var zn,Gn,qn,Hn=z.Array.from,Kn=t(function(e){e.exports={default:Hn,__esModule:!0}}),Wn=e(Kn),Xn=(e(t(function(e,t){t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(Kn);t.default=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return(0,n.default)(e)}})),function(e){function t(n,r,o){if(i(n)||a(n)){r=r||(a(n)?{}:[]);for(var s in n)r[s]=t(n[s],r[s],s);return r}return e(n,r,o)}return t}(function(e){return e})),Jn=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e},Zn=t(function(e){var t={},n={},i=e.exports=function(e,i,r,a,o){var s,u,l,c,h=o?function(){return e}:Pn(e),f=q(r,a,i?2:1),d=0;if("function"!=typeof h)throw TypeError(e+" is not iterable!");if(Tn(h)){for(s=we(e.length);s>d;d++)if((c=i?f(K(u=e[d])[0],u[1]):f(e[d]))===t||c===n)return c}else for(l=h.call(e);!(u=l.next()).done;)if((c=Bn(l,f,u.value,i))===t||c===n)return c};i.BREAK=t,i.RETURN=n}),Yn=He("species"),$n=function(e,t){var n,i=K(e).constructor;return void 0===i||void 0==(n=K(i)[Yn])?t:G(n)},Qn=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)},ei=V.process,ti=V.setImmediate,ni=V.clearImmediate,ii=V.MessageChannel,ri=0,ai={},oi=function(){var e=+this;if(ai.hasOwnProperty(e)){var t=ai[e];delete ai[e],t()}},si=function(e){oi.call(e.data)};ti&&ni||(ti=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return ai[++ri]=function(){Qn("function"==typeof e?e:Function(e),t)},zn(ri),ri},ni=function(e){delete ai[e]},"process"==_e(ei)?zn=function(e){ei.nextTick(q(oi,e,1))}:ii?(qn=(Gn=new ii).port2,Gn.port1.onmessage=si,zn=q(qn.postMessage,qn,1)):V.addEventListener&&"function"==typeof postMessage&&!V.importScripts?(zn=function(e){V.postMessage(e+"","*")},V.addEventListener("message",si,!1)):zn="onreadystatechange"in Y("script")?function(e){Ne.appendChild(Y("script")).onreadystatechange=function(){Ne.removeChild(this),oi.call(e)}}:function(e){setTimeout(q(oi,e,1),0)});var ui,li,ci,hi={set:ti,clear:ni},fi=hi.set,di=V.MutationObserver||V.WebKitMutationObserver,vi=V.process,pi=V.Promise,mi="process"==_e(vi),yi=He("species"),gi=hi.set,_i=function(){var e,t,n,i=function(){var i,r;for(mi&&(i=vi.domain)&&i.exit();e;){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,i&&i.enter()};if(mi)n=function(){vi.nextTick(i)};else if(di){var r=!0,a=document.createTextNode("");new di(i).observe(a,{characterData:!0}),n=function(){a.data=r=!r}}else if(pi&&pi.resolve){var o=pi.resolve();n=function(){o.then(i)}}else n=function(){fi.call(V,i)};return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}(),bi=V.TypeError,Si=V.process,ki=V.Promise,Si=V.process,wi="process"==In(Si),Ai=function(){},xi=!!function(){try{var e=ki.resolve(1),t=(e.constructor={})[He("species")]=function(e){e(Ai,Ai)};return(wi||"function"==typeof PromiseRejectionEvent)&&e.then(Ai)instanceof t}catch(e){}}(),Ei=function(e,t){return e===t||e===ki&&t===ci},Bi=function(e){var t;return!(!H(e)||"function"!=typeof(t=e.then))&&t},Li=function(e){return Ei(ki,e)?new Di(e):new li(e)},Di=li=function(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw bi("Bad Promise constructor");t=e,n=i}),this.resolve=G(t),this.reject=G(n)},Ti=function(e){try{e()}catch(e){return{error:e}}},Ci=function(e,t){if(!e._n){e._n=!0;var n=e._c;_i(function(){for(var i=e._v,r=1==e._s,a=0;n.length>a;)!function(t){var n,a,o=r?t.ok:t.fail,s=t.resolve,u=t.reject,l=t.domain;try{o?(r||(2==e._h&&Ri(e),e._h=1),!0===o?n=i:(l&&l.enter(),n=o(i),l&&l.exit()),n===t.promise?u(bi("Promise-chain cycle")):(a=Bi(n))?a.call(n,s,u):s(n)):u(i)}catch(e){u(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&Oi(e)})}},Oi=function(e){gi.call(V,function(){var t,n,i,r=e._v;if(Mi(e)&&(t=Ti(function(){wi?Si.emit("unhandledRejection",r,e):(n=V.onunhandledrejection)?n({promise:e,reason:r}):(i=V.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=wi||Mi(e)?2:1),e._a=void 0,t)throw t.error})},Mi=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,i=0;n.length>i;)if((t=n[i++]).fail||!Mi(t.promise))return!1;return!0},Ri=function(e){gi.call(V,function(){var t;wi?Si.emit("rejectionHandled",e):(t=V.onrejectionhandled)&&t({promise:e,reason:e._v})})},Ii=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Ci(t,!0))},Ui=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw bi("Promise can't be resolved itself");(t=Bi(e))?_i(function(){var i={_w:n,_d:!1};try{t.call(e,q(Ui,i,1),q(Ii,i,1))}catch(e){Ii.call(i,e)}}):(n._v=e,n._s=1,Ci(n,!1))}catch(e){Ii.call({_w:n,_d:!1},e)}}};xi||(ki=function(e){Jn(this,ki,"Promise","_h"),G(e),ui.call(this);try{e(q(Ui,this,1),q(Ii,this,1))}catch(e){Ii.call(this,e)}},(ui=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:ie(e,i,t[i]);return e}(ki.prototype,{then:function(e,t){var n=Li($n(this,ki));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=wi?Si.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ci(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Di=function(){var e=new ui;this.promise=e,this.resolve=q(Ui,e,1),this.reject=q(Ii,e,1)}),ae(ae.G+ae.W+ae.F*!xi,{Promise:ki}),Xe(ki,"Promise"),function(e){var t="function"==typeof z[e]?z[e]:V[e];X&&t&&!t[yi]&&te.f(t,yi,{configurable:!0,get:function(){return this}})}("Promise"),ci=z.Promise,ae(ae.S+ae.F*!xi,"Promise",{reject:function(e){var t=Li(this);return(0,t.reject)(e),t.promise}}),ae(ae.S+!0*ae.F,"Promise",{resolve:function(e){if(e instanceof ki&&Ei(e.constructor,this))return e;var t=Li(this);return(0,t.resolve)(e),t.promise}}),ae(ae.S+ae.F*!(xi&&Vn(function(e){ki.all(e).catch(Ai)})),"Promise",{all:function(e){var t=this,n=Li(t),i=n.resolve,r=n.reject,a=Ti(function(){var n=[],a=0,o=1;Zn(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||i(n))},r)}),--o||i(n)});return a&&r(a.error),n.promise},race:function(e){var t=this,n=Li(t),i=n.reject,r=Ti(function(){Zn(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r&&i(r.error),n.promise}});var Pi=z.Promise,ji=(t(function(e){e.exports={default:Pi,__esModule:!0}}),"undefined"!=typeof window&&Object.prototype.toString.call(window),Object.assign),Fi=!ji||W(function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(e){t[e]=e}),7!=ji({},e)[n]||Object.keys(ji({},t)).join("")!=i})?function(e,t){for(var n=Ye(e),i=arguments.length,r=1,a=St.f,o=kt.f;i>r;)for(var s,u=be(arguments[r++]),l=a?je(u).concat(a(u)):je(u),c=l.length,h=0;c>h;)o.call(u,s=l[h++])&&(n[s]=u[s]);return n}:ji;ae(ae.S+ae.F,"Object",{assign:Fi});var Ni=z.Object.assign,Vi=e(t(function(e){e.exports={default:Ni,__esModule:!0}}));ae(ae.S,"Object",{create:qe});var zi=z.Object,Gi=function(e,t){return zi.create(e,t)},qi=e(t(function(e){e.exports={default:Gi,__esModule:!0}})),Hi=qi(null);Hi.count=0;var Ki=function(){function e(t,n){var i=this;if(N(this,e),Object.defineProperty(this,"__target",{writable:!0,enumerable:!1,configurable:!0}),this.__target=this,t){if("object"!==(void 0===t?"undefined":hn(t)))throw new Error("CusEvent target are not object");this.__target=t,n&&["on","once","off","emit"].forEach(function(e){t[e]=i[e]})}}return le(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return m(this.__target,e,t,n),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this.__target,e,t,n),this}},{key:"emit",value:function(e,t){return p(this.__target,e,{data:t}),this}}]),e}(),Wi=qi(null);Wi.count=0;(function(){function e(t,n){var i=this;if(N(this,e),Object.defineProperty(this,"__target",{writable:!0,enumerable:!1,configurable:!0}),this.__target=this,t){if("object"!==(void 0===t?"undefined":hn(t)))throw new Error("CusEvent target are not object");this.__target=t,n&&["on","once","off","emit"].forEach(function(e){t[e]=i[e]})}}le(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return b(this.__target,e,t,n),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return S(this.__target,e,t,n),this}},{key:"emit",value:function(e,t){return _(this.__target,e,{data:t}),this}}])})(),"undefined"!=typeof window&&Object.prototype.toString.call(window);var Xi=document.createElement("div"),Ji="innerText";"textContent"in Xi&&(Ji="textContent");var Zi=Array.prototype,Yi=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;N(this,e);var r=this;r.selector=t;var a=void 0;t&&t.constructor===NodeList?a=k(t):i(t)?a=t:s(t)?0===t.indexOf("<")?(Xi.innerHTML=t,a=R("*",Xi,!0)):a=R(t,n,!0):a=[t],Vi(r,a),r.length=a.length}return le(e,[{key:"each",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Zi.forEach.apply(this,t),this}},{key:"push",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Zi.push.apply(this,t),this}},{key:"splice",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return P(Zi.splice.apply(this,t))}},{key:"find",value:function(e){var t=[];this.each(function(n){t=t.concat(R(e,n,!0))});var n=P(t);return n.parent=this,n.selector=e,n}},{key:"append",value:function(e){var t=P(e),n=this[0];return t.each(function(e){return n.appendChild(e)}),this}},{key:"appendTo",value:function(e){return P(e).append(this),this}},{key:"text",value:function(e){return 0===arguments.length?this[0][Ji]:this.each(function(t){t[Ji]=e})}},{key:"html",value:function(e){return 0===arguments.length?this[0].innerHTML:this.each(function(t){t.innerHTML=e})}},{key:"attr",value:function(e,t){return 1===arguments.length?w(this[0],e):this.each(function(n){return A(n,e,t)})}},{key:"data",value:function(e,t){return 0===arguments.length?this[0].dataset||{}:1===arguments.length?(this[0].dataset||{})[e]:this.each(function(n){(n.dataset||(n.dataset={}))[e]=t})}},{key:"css",value:function(e,t){return 1!==arguments.length||a(e)?this.each(function(n){return M(n,e,t)}):O(this[0],e)}},{key:"addClass",value:function(e){return this.each(function(t){return x(t,e)})}},{key:"removeClass",value:function(e){return this.each(function(t){return E(t,e)})}},{key:"hasClass",value:function(e){return B(this[0],e)}},{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return D(r,e,t,n,i)})}},{key:"off",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return L(r,e,t,n,i)})}},{key:"delegate",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return T(r,e,t,n,i)})}},{key:"undelegate",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.each(function(r){return C(r,e,t,n,i)})}},{key:"remove",value:function(){return this.each(function(e){return I(e)})}}]),e}(),$i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qi=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},er=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tr=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},nr=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ir=function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.video=e,i.config=n,i.tag="mse-controller",i.e={onSourceOpen:i.onSourceOpen.bind(i),onSourceEnded:i.onSourceEnded.bind(i),onSourceClose:i.onSourceClose.bind(i),onSourceBufferError:i.onSourceBufferError.bind(i)},i.queue=[],i.removeRangesList=[],i.removeBucketing=!1,i.mimeCodec='video/mp4; codecs="avc1.640020,mp4a.40.2"',i.init(),i}return tr(t,Ki),er(t,[{key:"init",value:function(){if(this.mediaSource)throw En.Error(this.tag,"MediaSource has been attached to an HTMLMediaElement!"),new Error("MediaSource has been attached to an HTMLMediaElement!");var e=this.mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose)}},{key:"onSourceOpen",value:function(){var e=this;En.verbose(this.tag,"MediaSource onSourceOpen"),this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),window.sou=this.sourceBuffer=this.mediaSource.addSourceBuffer(this.mimeCodec),this.sourceBuffer.addEventListener("error",this.e.onSourceBufferError),this.sourceBuffer.addEventListener("abort",function(){return console.log("sourceBuffer: abort")}),this.sourceBuffer.addEventListener("updateend",function(){if(e.queue.length>=1&&!e.sourceBuffer.updating)if(e.needCleanupSourceBuffer())e.doCleanupSourceBuffer();else{var t=e.queue.shift();e.appendBuffer(t)}e.emit("updateend")}),this.emit("source_open"),this.sourceBufferEvent()}},{key:"sourceBufferEvent",value:function(){var e=this;this.on("mediaSegment",function(t){var n=t.data;e.sourceBuffer.updating||e.queue.length>0?e.queue.push(n):e.appendBuffer(n)}),this.on("mediaSegmentInit",function(t){var n=t.data;e.sourceBuffer.updating||e.queue.length>0?e.queue.push(n):e.appendBuffer(n)})}},{key:"needCleanupSourceBuffer",value:function(){var e=this.video.currentTime,t=this.sourceBuffer.buffered;return t.length>=1&&e-t.start(0)>=this.config.autoCleanupMaxBackwardDuration}},{key:"doCleanupSourceBuffer",value:function(){En.verbose(this.tag,"docleanBuffer");for(var e=this.video.currentTime,t=this.sourceBuffer.buffered,n=!1,i=0;i<t.length;i++){var r=t.start(i),a=t.end(i);if(r<=e&&e<a+3){if(e-r>=this.config.autoCleanupMaxBackwardDuration){n=!0;var o=e-this.config.autoCleanupMinBackwardDuration;this.removeRangesList.push({start:r,end:o})}}else a<e&&(n=!0,this.removeRangesList.push({start:r,end:a}))}n&&!this.sourceBuffer.updating&&this.cleanRangesList()}},{key:"cleanRangesList",value:function(){if(!this.sourceBuffer.updating)for(var e=this.sourceBuffer;this.removeRangesList.length&&!e.updating;){var t=this.removeRangesList.shift();e.remove(t.start,t.end)}}},{key:"appendBuffer",value:function(e){try{this.sourceBuffer.appendBuffer(e)}catch(e){22===e.code&&(En.verbose(this.tag,"MediaSource bufferFull"),this.emit("bufferFull"))}}},{key:"onSourceEnded",value:function(){En.verbose(this.tag,"MediaSource onSourceEnded")}},{key:"onSourceClose",value:function(){En.verbose(this.tag,"MediaSource onSourceClose"),this.mediaSource&&null!==this.e&&(this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this.mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this.mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"onSourceBufferError",value:function(e){En.error(this.tag,"SourceBuffer Error: "+e)}},{key:"seek",value:function(){}},{key:"destroy",value:function(){if(this.mediaSource){var e=this.mediaSource;this.queue=[];var t=this.sourceBuffer;if(t&&("closed"!==e.readyState&&(e.removeSourceBuffer(t),t.removeEventListener("error",this.e.onSourceBufferError),t.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this.sourceBuffer=null),"open"===e.readyState)try{e.endOfStream()}catch(e){En.e(this.tag,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this.mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}}]),t}(),rr=function(e){var t={},n=void 0;return n=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",t.Range=n,{headers:t}},ar=function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="fetch",i.fetching=!1,i.config=n,i.range={from:0,to:5e5},i.src=e,i.totalRange=null,i.block=5e5,i.reader=null,i.requestAbort=!1,i.arrivalDataCallback=null,i.bytesStart=0,i}return tr(t,Ki),er(t,null,[{key:"isSupport",value:function(){return!(!window.fetch||!window.ReadableStream)}}]),er(t,[{key:"open",value:function(e,t){var n=this;this.requestAbort=!1;var i=new Headers,r=e||{from:0,to:-1};if(!this.config.isLive){this.range.from=r.from,this.range.to=r.to;var a=rr(r).headers;for(var o in a)i.append(o,a[o])}t&&(this.bytesStart=0),this.req=new Request(this.src,{headers:i}),fetch(this.req).then(function(e){if(e.ok){var i=e.body.getReader();return n.pump(i,t)}})}},{key:"pause",value:function(){this.requestAbort=!0}},{key:"pump",value:function(e,t){var n=this;return e.read().then(function(i){if(!i.done){if(!0===n.requestAbort)return e.cancel();var r=i.value.buffer;return n.arrivalDataCallback&&(n.arrivalDataCallback(r,n.bytesStart,t),n.bytesStart+=r.byteLength),n.pump(e)}En.verbose(n.tag,"play end")})}}]),t}(),or=function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="RangeLoader",i.xhr=null,i.src=e,i.totalLength=null,i.chunkSizeKB=393216,i.range={},i.bytesStart=0,i}return tr(t,Ki),er(t,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return!1}}}]),er(t,[{key:"open",value:function(e){var t=this.xhr=new XMLHttpRequest;t.open("GET",this.src,!0),t.responseType="arraybuffer",t.onreadystatechange=this.onReadyStateChange.bind(this),t.onprogress=this.onProgress.bind(this),t.onload=this.onLoad.bind(this),t.onerror=this.onXhrError.bind(this);var n=e||{from:0,to:-1};this.range.from=n.from,this.range.to=n.to;var i=rr(n).headers;for(var r in i)t.setRequestHeader(r,i[r]);t.send()}},{key:"abort",value:function(){this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr.abort(),this.xhr=null}},{key:"destroy",value:function(){this.xhr&&(this.abort(),this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr=null),this.totalLength=null,this.bytesStart=null,this.range={}}},{key:"onReadyStateChange",value:function(e){var t=this.xhr;if(2===t.readyState&&t.status<200&&t.status>299){var n={from:this.range.from,to:this.range.to,url:this.src,msg:"http Error: http code "+t.status};this.emit(this.tag,n)}}},{key:"onProgress",value:function(e){this.totalLength||(this.totalLength=e.total,this.abort(),this.open({from:0,to:this.chunkSizeKB}))}},{key:"onLoad",value:function(e){if(this.totalLength&&(this.range.to,this.totalLength,this.arrivalDataCallback)){var t=e.target.response;this.arrivalDataCallback(t,this.bytesStart),this.bytesStart+=t.byteLength}}},{key:"onXhrError",value:function(e){var t={from:this.range.from,to:this.range.to,url:this.src,msg:e.constructor.name+" "+e.type};this.emit(this.tag,t)}}]),t}(),sr=function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="mozChunkLoader",i.xhr=null,i.src=e,i.config=n,i.totalLength=null,i.chunkSizeKB=393216,i.range={},i.bytesStart=0,i}return tr(t,Ki),er(t,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return!1}}}]),er(t,[{key:"open",value:function(e){var t=this.xhr=new XMLHttpRequest;if(t.open("GET",this.src,!0),t.responseType="moz-chunked-arraybuffer",t.onreadystatechange=this.onReadyStateChange.bind(this),t.onprogress=this.onProgress.bind(this),t.onload=this.onLoadEnd.bind(this),t.onerror=this.onXhrError.bind(this),!this.config.isLive){var n=e||{from:0,to:-1};this.range.from=n.from,this.range.to=n.to;var i=rr(n).headers;for(var r in i)t.setRequestHeader(r,i[r])}t.send()}},{key:"abort",value:function(){this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr.abort(),this.xhr=null}},{key:"destroy",value:function(){this.xhr&&(this.abort(),this.xhr.onreadystatechange=null,this.xhr.onprogress=null,this.xhr.onload=null,this.xhr.onerror=null,this.xhr=null),this.totalLength=null,this.bytesStart=null,this.range={}}},{key:"onReadyStateChange",value:function(e){var t=this.xhr;if(2===t.readyState&&t.status<200&&t.status>299){var n={from:this.range.from,to:this.range.to,url:this.src,msg:"http Error: http code "+t.status};this.emit(this.tag,n)}}},{key:"onProgress",value:function(e){this.totalLength||(this.totalLength=e.total,null!==e.total&&0!==e.total&&(this.totalLength=e.total));var t=e.target.response;this.arrivalDataCallback(t,this.bytesStart),this.bytesStart+=t.byteLength}},{key:"onLoadEnd",value:function(e){this.emit(this.tag,"video load end")}},{key:"onXhrError",value:function(e){var t={from:this.range.from,to:this.range.to,url:this.src,msg:e.constructor.name+" "+e.type};this.emit(this.tag,t)}}]),t}(),ur=function(e){function t(e){Qi(this,t);var n=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.loader=null,n.config={},Object.assign(n.config,e),n.selectLoader(),n.bufferSize=3145728,n.cacheBuffer=new ArrayBuffer(n.bufferSize),n.cacheRemain=0,n.stashByteStart=0,n.enableStash=!0,n.stashSize=393216,n.resumeFrom=0,n.currentRange={},n.totalReceive=0,n.seekPonit=0,n.timer=null,n}return tr(t,Ki),er(t,[{key:"selectLoader",value:function(){var e=this.config,t=this.config.src;ar.isSupport()?this.loader=new ar(t,e):sr.isSupport()?this.loader=new sr(t,e):or.isSupport()&&(this.loader=new or(t,e)),this.loader.arrivalDataCallback=this.onLoaderChunkArrival.bind(this)}},{key:"onLoaderChunkArrival",value:function(e,t,n){if(n&&(this.seekPonit=n),this.arrivalDataCallback)if(this.totalReceive+=e.byteLength,0===this.cacheRemain&&0===this.stashByteStart&&(this.stashByteStart=t),this.cacheRemain+e.byteLength<=this.stashSize)new Uint8Array(this.cacheBuffer,0,this.stashSize).set(new Uint8Array(e),this.cacheRemain),this.cacheRemain+=e.byteLength;else{var i=new Uint8Array(this.cacheBuffer,0,this.bufferSize);if(this.cacheRemain>0){var r=this.cacheBuffer.slice(0,this.cacheRemain),a=0;if(this.seekPonit?(a=this.arrivalDataCallback(r,this.stashByteStart,this.seekPonit),this.seekPonit=0):a=this.arrivalDataCallback(r,this.stashByteStart),a<r.byteLength){if(a>0){var o=new Uint8Array(r,a);i.set(o,0),this.cacheRemain=o.byteLength,this.stashByteStart+=a}}else this.cacheRemain=0,this.stashByteStart+=a;this.cacheRemain+e.byteLength>this.bufferSize&&(this.expandBuffer(this.cacheRemain+e.byteLength),i=new Uint8Array(this.cacheBuffer,0,this.bufferSize)),i.set(new Uint8Array(e),this.cacheRemain),this.cacheRemain+=e.byteLength}else{var s=0;if(this.seekPonit?(s=this.arrivalDataCallback(e,t,this.seekPonit),this.seekPonit=0):s=this.arrivalDataCallback(e,t),s<e.byteLength){var u=e.byteLength-s;u>this.bufferSize&&(this.expandBuffer(u),i=new Uint8Array(this.cacheBuffer,0,this.bufferSize)),i.set(new Uint8Array(e,s),0),this.cacheRemain+=u,this.stashByteStart=t+s}}}}},{key:"initCacheBuffer",value:function(){this.cacheBuffer=new ArrayBuffer(this.bufferSize)}},{key:"expandBuffer",value:function(e){var t=this.bufferSize;t<e&&(t=e),this.cacheBuffer=new ArrayBuffer(t),this.bufferSize=t}},{key:"pause",value:function(){this.loader.pause()}},{key:"open",value:function(e){void 0===e&&(e=0),this.loader.open({from:e,to:-1})}},{key:"resume",value:function(){this.paused=!1;var e=this.totalReceive;this.open(e)}},{key:"seek",value:function(e,t,n){this.loader.open({from:e,to:-1},n)}},{key:"destroy",value:function(){this.pause(),this.cacheBuffer=null}}]),t}(),lr=arguments[3],cr=arguments[4],hr=arguments[5],fr=JSON.stringify,dr=function(e,t){function n(e){f[e]=!0;for(var t in cr[e][1]){var i=cr[e][1][t];f[i]||n(i)}}for(var i,r=Object.keys(hr),a=0,o=r.length;a<o;a++){var s=r[a],u=hr[s].exports;if(u===e||u&&u.default===e){i=s;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var l={},a=0,o=r.length;a<o;a++)l[s=r[a]]=s;cr[i]=[Function(["require","module","exports"],"("+e+")(self)"),l]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),h={};h[i]=i,cr[c]=[Function(["require"],"var f = require("+fr(i)+");(f.default ? f.default : f)(self);"),h];var f={};n(c);var d="("+lr+")({"+Object.keys(f).map(function(e){return fr(e)+":["+cr[e][0]+","+fr(cr[e][1])+"]"}).join(",")+"},{},["+fr(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,p=new Blob([d],{type:"text/javascript"});if(t&&t.bare)return p;var m=v.createObjectURL(p),y=new Worker(m);return y.objectURL=m,y},vr=function(){function e(){Qi(this,e),this.tagType=-1,this.dataSize=-1,this.Timestamp=-1,this.StreamID=-1,this.body=-1,this.time=-1,this.arr=[]}return er(e,[{key:"getTime",value:function(){this.arr=[];for(var e=0;e<this.Timestamp.length;e++)this.arr.push(1==this.Timestamp[e].toString(16).length?"0"+this.Timestamp[e].toString(16):this.Timestamp[e].toString(16));this.arr.pop();var t=this.arr.join("");return this.time=parseInt(t,16),parseInt(t,16)}}]),e}(),pr=function(){function e(t){Qi(this,e),this.TAG=this.constructor.name,this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return er(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(i,this._current_word_bits_left),a=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,n=n<<r|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),mr=function(){function e(){Qi(this,e)}return er(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,a=0;a<n;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(i[r]=t[a],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new pr(n);i.readByte();var r=i.readByte();i.readByte();var a=i.readByte();i.readUEG();var o=e.getProfileString(r),s=e.getLevelString(a),u=1,l=420,c=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(l=c[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)i.readBool()&&(d<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var v=i.readUEG();if(0===v)i.readUEG();else if(1===v){i.readBits(1),i.readSEG(),i.readSEG();for(var p=i.readUEG(),m=0;m<p;m++)i.readSEG()}i.readUEG(),i.readBits(1);var y=i.readUEG(),g=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);var b=0,S=0,k=0,w=0;i.readBool()&&(b=i.readUEG(),S=i.readUEG(),k=i.readUEG(),w=i.readUEG());var A=1,x=1,E=0,B=!0,L=0,D=0;if(i.readBool()){if(i.readBool()){var T=i.readByte(),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];T>0&&T<16?(A=C[T-1],x=O[T-1]):255===T&&(A=i.readByte()<<8|i.readByte(),x=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var M=i.readBits(32),R=i.readBits(32);B=i.readBool(),E=(L=R)/(D=2*M)}}var I=1;1===A&&1===x||(I=A/x);var U=0,P=0;0===u?(U=1,P=2-_):(U=3===u?1:2,P=(1===u?2:1)*(2-_));var j=16*(y+1),F=16*(g+1)*(2-_);j-=(b+S)*U,F-=(k+w)*P;var N=Math.ceil(j*I);return i.destroy(),i=null,{profile_string:o,level_string:s,bit_depth:h,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:B,fps:E,fps_den:D,fps_num:L},sar_ratio:{width:A,height:x},codec_size:{width:j,height:F},present_size:{width:N,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=(n+e.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}(),yr=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),gr=function(){function e(){Qi(this,e)}return er(e,null,[{key:"parseObject",value:function(t,n,i){var r=e.parseString(t,n,i),a=e.parseScript(t,n+r.size),o=a.objectEnd;return{data:{name:r.data,value:a.data},size:a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,n,i){return e.parseObject(t,n,i)}},{key:"parseLongString",value:function(e,t,n){var i=new DataView(e,t).getUint32(0,!yr),r=void 0;return r=i>0?j(new Uint8Array(e,t+4,i)):"",{data:r,size:4+i}}},{key:"parseDate",value:function(e,t,n){var i=new DataView(e,t),r=i.getFloat64(0,!yr);return r+=60*i.getInt16(8,!yr)*1e3,{data:new Date(r),size:10}}},{key:"parseString",value:function(e,t,n){var i=new DataView(e,t).getUint16(0,!yr),r=void 0;return r=i>0?j(new Uint8Array(e,t+2,i)):"",{data:r,size:2+i}}},{key:"parseMetadata",value:function(t){var n=e.parseScript(t,0),i=e.parseScript(t,n.size,t.length-n.size),r={};return r[n.data]=i.data,r}},{key:"parseScript",value:function(t,n,i){var r=n,a=new Uint8Array(t).buffer,o=new DataView(a,0,i),s=null,u=o.getUint8(r);switch(r+=1,u){case 0:s=o.getFloat64(r,!yr),r+=8;break;case 1:s=!!o.getUint8(r),r+=1;break;case 2:var l=e.parseString(a,r);s=l.data,r+=l.size;break;case 3:s={};var c=0;for(9==(16777215&o.getUint32(i-4,!yr))&&(c=3);r<i-4;){var h=e.parseObject(a,r,i-n-c);if(h.objectEnd)break;s[h.data.name]=h.data.value,r=h.size}r<=i-3&&9===(16777215&v.getUint32(r-1,!yr))&&(r+=3);break;case 8:s={},r+=4;for(9==(16777215&o.getUint32(i-4,!yr))&&3;r<i-8;){var f=e.parseVariable(a,r);if(f.objectEnd)break;s[f.data.name]=f.data.value,r=f.size}r<=i-3&&9===(16777215&o.getUint32(r-1,!yr))&&(r+=3);break;case 9:s=void 0,r=1,!0;break;case 10:s=[];var d=o.getUint32(r,!yr);r+=4;for(var p=0;p<d;p++){var m=e.parseScript(a,r);s.push(m.data),r=m.size}break;case 11:var y=e.parseDate(a,r+1,i-1);s=y.data,r+=y.size;break;case 12:var g=e.parseString(a,r+1,i-1);s=g.data,r+=g.size;break;default:r=i,console.log("AMF","Unsupported AMF value type "+u)}return{data:s,size:r}}}]),e}(),_r=function(){function e(){Qi(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return er(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}}]),e}(),br=function e(t){Qi(this,e),this.type=t},Sr=new(function(){function e(){Qi(this,e),this.TAG=this.constructor.name,this._config={},this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=0,this._firstParse=!0,this._dispatch=!1,this._hasAudio=!1,this._hasVideo=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new _r,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._videoTrack={type:"video",id:1,sequenceNumber:0,addcoefficient:2,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:1,addcoefficient:2,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return er(e,[{key:"onMediaInfo",value:function(e){this._onMediaInfo=e}},{key:"parseMetadata",value:function(e){var t=gr.parseMetadata(e);this._parseScriptData(t)}},{key:"_parseScriptData",value:function(e){var t=e;if(t.hasOwnProperty("onMetaData")){this._metadata&&console.log(this.TAG,"Found another onMetaData tag!"),this._metadata=t;var n=this._metadata.onMetaData;if("boolean"==typeof n.hasAudio&&(this._hasAudio=n.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof n.hasVideo&&(this._hasVideo=n.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof n.audiodatarate&&(this._mediaInfo.audioDataRate=n.audiodatarate),"number"==typeof n.videodatarate&&(this._mediaInfo.videoDataRate=n.videodatarate),"number"==typeof n.width&&(this._mediaInfo.width=n.width),"number"==typeof n.height&&(this._mediaInfo.height=n.height),"number"==typeof n.duration){if(!this._durationOverrided){var i=Math.floor(n.duration*this._timescale);this._duration=i,this._mediaInfo.duration=i}}else this._mediaInfo.duration=0;if("number"==typeof n.framerate){var r=Math.floor(1e3*n.framerate);if(r>0){var a=r/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=a,this._referenceFrameRate.fps_num=r,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=a}}if("object"===$i(n.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var o=n.keyframes;o.times=n.times,o.filepositions=n.filepositions,this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(o),n.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;return this._dispatch=!1,this._mediaInfo.metadata=n,console.log(this.TAG,"Parsed onMetaData"),this._mediaInfo}}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],n=[],i=1;i<e.times.length;i++){var r=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(r),n.push(e.filepositions[i])}return{times:t,filepositions:n}}},{key:"moofTag",value:function(e){for(var t=0;t<e.length;t++)this._dispatch=!0,this.parseChunks(e[t]);this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack)}},{key:"parseChunks",value:function(e){switch(e.tagType){case 8:this._parseAudioData(e.body.buffer,0,e.body.length,e.getTime());break;case 9:this._parseVideoData(e.body.buffer,0,e.body.length,e.getTime(),0);break;case 18:this.parseMetadata(e.body)}}},{key:"_parseVideoData",value:function(e,t,n,i,r){if(i==this._timestampBase&&0!=this._timestampBase)throw new br(i+this._timestampBase+"夭寿啦这个视频不是从0开始");if(n<=1)console.log(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else{var a=new Uint8Array(e,t,n)[0],o=(240&a)>>>4,s=15&a;if(7!==s)throw new br("Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(e,t+1,n-1,i,r,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,n,i,r,a){if(n<4)console.log(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var o=this._littleEndian,s=new DataView(e,t,n),u=s.getUint8(0),l=16777215&s.getUint32(0,!o);if(0===u)this._parseAVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===u)this._parseAVCVideoData(e,t+4,n-4,i,r,a,l);else if(2!==u)throw new br("Flv: Invalid video packet type "+u)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,n){if(n<7)console.log(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,r=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,n);i?void 0!==i.avcc&&console.log(this.TAG,"Found another AVCDecoderConfigurationRecord!"):((i=this._videoMetadata={}).type="video",i.id=r.id,i.timescale=this._timescale,i.duration=this._duration);var s=o.getUint8(0),u=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1===s&&0!==u)if(this._naluLengthSize=1+(3&o.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var l=31&o.getUint8(5);if(0===l||l>1)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 SPS count: "+l);else{for(var c=6,h=0;h<l;h++){var f=o.getUint16(c,!a);if(c+=2,0!==f){var d=new Uint8Array(e,t+c,f);c+=f;var v=mr.parseSPS(d);i.codecWidth=v.codec_size.width,i.codecHeight=v.codec_size.height,i.presentWidth=v.present_size.width,i.presentHeight=v.present_size.height,i.profile=v.profile_string,i.level=v.level_string,i.bitDepth=v.bit_depth,i.chromaFormat=v.chroma_format,i.sarRatio=v.sar_ratio,i.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var p=i.frameRate.fps_den,m=i.frameRate.fps_num;i.refSampleDuration=Math.floor(i.timescale*(p/m));for(var y=d.subarray(1,4),g="avc1.",_=0;_<3;_++){var b=y[_].toString(16);b.length<2&&(b="0"+b),g+=b}i.codec=g;var S=this._mediaInfo;S.width=i.codecWidth,S.height=i.codecHeight,S.fps=i.frameRate.fps,S.profile=i.profile,S.level=i.level,S.chromaFormat=v.chroma_format_string,S.sarNum=i.sarRatio.width,S.sarDen=i.sarRatio.height,S.videoCodec=g,S.hasAudio?null!=S.audioCodec&&(S.mimeType='video/x-flv; codecs="'+S.videoCodec+","+S.audioCodec+'"'):S.mimeType='video/x-flv; codecs="'+S.videoCodec+'"',S.isComplete()&&this._onMediaInfo(S)}}var k=o.getUint8(c);if(0===k||k>1)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 PPS count: "+k);else{c++;for(var w=0;w<k;w++){var A=o.getUint16(c,!a);c+=2,0!==A&&(c+=A)}i.avcc=new Uint8Array(n),i.avcc.set(new Uint8Array(e,t,n),0),console.log(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}}}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"timestampBase",value:function(e){this._timestampBase=e}},{key:"_parseAVCVideoData",value:function(e,t,n,i,r,a,o){for(var s=this._littleEndian,u=new DataView(e,t,n),l=[],c=0,h=0,f=this._naluLengthSize,d=this._timestampBase+i,v=1===a;h<n;){if(h+4>=n){console.log(this.TAG,"Malformed Nalu near timestamp "+d+", offset = "+h+", dataSize = "+n);break}var p=u.getUint32(h,!s);if(3===f&&(p>>>=8),p>n-f)return void console.log(this.TAG,"Malformed Nalus near timestamp "+d+", NaluSize > DataSize!");var m=31&u.getUint8(h+f);5===m&&(v=!0);var y=new Uint8Array(e,t+h,f+p),g={type:m,data:y};l.push(g),c+=y.byteLength,h+=f+p}if(l.length){var _=this._videoTrack,b={units:l,length:c,isKeyframe:v,dts:d,cts:o,pts:d+o};v&&(b.fileposition=r),_.samples.push(b),_.length+=c}}},{key:"_parseAudioData",value:function(e,t,n,i){if(i==this._timestampBase&&0!=this._timestampBase&&console.log(i,this._timestampBase,"夭寿啦这个视频不是从0开始"),n<=1)console.log(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else{var r=this._audioMetadata,a=this._audioTrack;if(!r||!r.codec){(r=this._audioMetadata={}).type="audio",r.id=a.id,r.timescale=this._timescale,r.duration=this._duration;this._littleEndian;var o=new DataView(e,t,n).getUint8(0),s=o>>>4;if(10!==s)return void this._onError(DemuxErrors.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s);var u=0,l=(12&o)>>>2,c=[5500,11025,22050,44100,48e3];if(!(l<c.length))return void this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);u=c[l];var h=1&o;r.audioSampleRate=u,r.channelCount=0===h?1:2,r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale),r.codec="mp4a.40.5"}var f=this._parseAACAudioData(e,t+1,n-1);if(void 0!=f){if(0===f.packetType){r.config&&console.log(this.TAG,"Found another AudioSpecificConfig!");var d=f.data;r.audioSampleRate=d.samplingRate,r.channelCount=d.channelCount,r.codec=d.codec,r.config=d.config,r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale),console.log(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",r);var v=this._mediaInfo;return v.audioCodec="mp4a.40."+d.originalAudioObjectType,v.audioSampleRate=r.audioSampleRate,v.audioChannelCount=r.channelCount,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',void(v.isComplete()&&this._onMediaInfo(v))}if(1===f.packetType){var p=this._timestampBase+i,m={unit:f.data,dts:p,pts:p};a.samples.push(m),a.length+=f.data.length}else console.log(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}}}},{key:"_parseAACAudioData",value:function(e,t,n){if(!(n<=1)){var i={},r=new Uint8Array(e,t,n);return i.packetType=r[0],0===r[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,n-1):i.data=r.subarray(1),i}console.log(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,n){var i=new Uint8Array(e,t,n),r=null,a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=0,s=0,u=0,l=null;if(o=s=i[0]>>>3,(u=(7&i[0])<<1|i[1]>>>7)<0||u>=a.length)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var c=a[u],h=(120&i[1])>>>3;if(!(h<0||h>=8)){5===o&&(l=(7&i[1])<<1|i[2]>>>7,(124&i[2])>>>2);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?u>=6?(o=5,r=new Array(4),l=u-3):(o=2,r=new Array(2),l=u):-1!==f.indexOf("android")?(o=2,r=new Array(2),l=u):(o=5,l=u,r=new Array(4),u>=6?l=u-3:1===h&&(o=2,r=new Array(2),l=u)),r[0]=o<<3,r[0]|=(15&u)>>>1,r[1]=(15&u)<<7,r[1]|=(15&h)<<3,5===o&&(r[1]|=(15&l)>>>1,r[2]=(1&l)<<7,r[2]|=8,r[3]=0),{config:r,samplingRate:c,channelCount:h,codec:"mp4a.40."+o,originalAudioObjectType:s}}this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:void 0}}]),e}()),kr=new(function(){function e(){Qi(this,e),this.tempUint8=new Uint8Array,this.arrTag=[],this.index=0,this.tempArr=[],this.stop=!1,this.offset=0,this.frist=!0,this._hasAudio=!1,this._hasVideo=!1}return er(e,[{key:"setFlv",value:function(e){return this.stop=!1,this.arrTag=[],this.index=0,this.tempUint8=e,this.tempUint8.length>13&&70==this.tempUint8[0]&&76==this.tempUint8[1]&&86==this.tempUint8[2]?(this.probe(this.tempUint8.buffer),this.read(9),this.read(4),this.parse(),this.frist=!1,this.offset):this.frist?this.offset:this.parse()}},{key:"probe",value:function(e){var t=new Uint8Array(e),n={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return n;var i=(4&t[4])>>>2!=0,r=0!=(1&t[4]);return i||r?(this._hasAudio=Sr._hasAudio=i,this._hasVideo=Sr._hasVideo=r,{match:!0,hasAudioTrack:i,hasVideoTrack:r}):n}},{key:"parse",value:function(){for(;this.index<this.tempUint8.length&&!this.stop;){this.offset=this.index;var e=new vr;if(this.tempUint8.length-this.index>=11){if(e.tagType=this.read(1)[0],e.dataSize=this.read(3),e.Timestamp=this.read(4),e.StreamID=this.read(3),18!=e.tagType&&8!=e.tagType&&9!=e.tagType)throw new br("wrong tagType"+e.tagType);this.tempUint8.length-this.index>=this.getBodySum(e.dataSize)+4?(e.body=this.read(this.getBodySum(e.dataSize)),9==e.tagType&&this._hasVideo&&this.arrTag.push(e),8==e.tagType&&this._hasAudio&&this.arrTag.push(e),18==e.tagType&&this.arrTag.push(e),this.read(4),this.offset=this.index):this.stop=!0}else this.stop=!0}return this.offset}},{key:"read",value:function(e){var t=this.tempUint8.slice(this.index,this.index+e);return this.index+=e,t}},{key:"getBodySum",value:function(e){var t="";return t+=1==e[0].toString(16).length?"0"+e[0].toString(16):e[0].toString(16),t+=1==e[1].toString(16).length?"0"+e[1].toString(16):e[1].toString(16),t+=1==e[2].toString(16).length?"0"+e[2].toString(16):e[2].toString(16),parseInt(t,16)}}]),e}()),wr=function(){function e(){Qi(this,e)}return er(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=e.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,n=null,i=Array.prototype.slice.call(arguments,1),r=i.length,a=0;a<r;a++)t+=i[a].byteLength;(n=new Uint8Array(t))[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var o=8,s=0;s<r;s++)n.set(i[s],o),o+=i[s].byteLength;return n}},{key:"generateInitSegment",value:function(t){t.constructor!=Array&&(t=[t]);var n=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),r=new Uint8Array(n.byteLength+i.byteLength);return r.set(n,0),r.set(i,n.byteLength),r}},{key:"moov",value:function(t){var n=e.mvhd(t[0].timescale,t[0].duration),i=e.trak(t[0]),r=void 0;t.length>1&&(r=e.trak(t[1]));var a=e.mvex(t);return t.length>1?e.box(e.types.moov,n,i,r,a):e.box(e.types.moov,n,i,a)}},{key:"mvhd",value:function(t,n){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var n=t.id,i=t.duration,r=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var n=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}},{key:"hdlr",value:function(t){var n=null;return n="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,n)}},{key:"minf",value:function(t){var n=null;return n="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,n,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp4a",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var n=t.config,i=n.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(n).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var n=t.avcc,i=t.codecWidth,r=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,4,103,49,49,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,n))}},{key:"mvex",value:function(t){return t.length>1?e.box(e.types.mvex,e.trex(t[0]),e.trex(t[1])):e.box(e.types.mvex,e.trex(t[0]))}},{key:"trex",value:function(t){var n=t.id,i=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)}},{key:"moof",value:function(t,n){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,n))}},{key:"mfhd",value:function(t){var n=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,n)}},{key:"traf",value:function(t,n){var i=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),o=e.sdtp(t),s=e.trun(t,o.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,a,s,o)}},{key:"sdtp",value:function(t){for(var n=t.samples||[],i=n.length,r=new Uint8Array(4+i),a=0;a<i;a++){var o=n[a].flags;r[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,n){var i=t.samples||[],r=i.length,a=12+16*r,o=new Uint8Array(a);n+=8+a,o.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var s=0;s<r;s++){var u=i[s].duration,l=i[s].size,c=i[s].flags,h=i[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return e.box(e.types.trun,o)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();wr.init();var Ar=function(){function e(){Qi(this,e)}return er(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}(),xr={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:n[0]||""},r={};if(i.browser){r[i.browser]=!0;var a=i.majorVersion.split(".");r.version={major:parseInt(i.majorVersion,10),string:i.version},a.length>1&&(r.version.minor=parseInt(a[1],10)),a.length>2&&(r.version.build=parseInt(a[2],10))}i.platform&&(r[i.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),(r.rv||r.iemobile)&&(r.rv&&delete r.rv,i.browser="msie",r.msie=!0);r.edge&&(delete r.edge,i.browser="msedge",r.msedge=!0);r.opr&&(i.browser="opera",r.opera=!0);r.safari&&r.android&&(i.browser="android",r.android=!0);r.name=i.browser,r.platform=i.platform;for(var o in xr)xr.hasOwnProperty(o)&&delete xr[o];Object.assign(xr,r)}();var Er=function e(t,n,i,r,a){Qi(this,e),this.dts=t,this.pts=n,this.duration=i,this.originalDts=r,this.isSyncPoint=a,this.fileposition=null},Br=function(){function e(){Qi(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return er(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),Lr=(function(){function e(){Qi(this,e),this._list=[]}er(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,n=0,i=t.length-1,r=0,a=0,o=i;for(e<t[0].dts&&(n=0,a=o+1);a<=o;){if((r=a+Math.floor((o-a)/2))===i||e>=t[r].dts&&e<t[r+1].dts){n=r;break}t[r].dts<e?a=r+1:o=r-1}return this._list[n]}}])}(),function(){function e(t){Qi(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return er(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var n=t.length-1,i=0,r=0,a=n,o=0;if(e<t[0].originalBeginDts)return o=-1;for(;r<=a;){if((i=r+Math.floor((a-r)/2))===n||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){o=i;break}t[i].originalBeginDts<e?r=i+1:a=i-1}return o}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,n=e,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&n.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&n.originalBeginDts<t[i+1].originalBeginDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,n)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),n=this._list[t].syncPoints;0===n.length&&t>0;)t--,n=this._list[t].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()),Dr=function(){function e(t){Qi(this,e),this.TAG=this.constructor.name,this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Lr("audio"),this._videoSegmentInfoList=new Lr("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!xr.chrome||!(xr.version.major<50||50===xr.version.major&&xr.version.build<2661)),this._fillSilentAfterSeek=xr.msedge||xr.msie}return er(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new br("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var n=null;if("audio"===e)this._audioMeta=t,n=wr.generateInitSegment(t),console.log("msg+audio",t);else{if("video"!==e)return;this._videoMeta=t,n=wr.generateInitSegment(t),console.log("msg+video",t)}if(!this._onInitSegment)throw new br("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:n.buffer,codec:t.codec,container:e+"/mp4"})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"_remuxAudio",value:function(e){var t=e,n=t.samples,i=void 0,r=-1,a=-1,o=!1,s=-1;if(n&&0!==n.length){var u=8+t.length,l=new Uint8Array(u);l[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(wr.types.mdat,4);for(var c=8,h=[];n.length;){var f=n.shift(),d=f.unit,v=f.dts-this._dtsBase;if(void 0==i)if(void 0==this._audioNextDts)if(this._audioSegmentInfoList.isEmpty())i=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&(o=!0);else{var p=this._audioSegmentInfoList.getLastSampleBefore(v);if(null!=p){var m=v-(p.originalDts+p.duration);m<=3&&(m=0),i=v-(p.dts+p.duration+m)}else i=0}else i=v-this._audioNextDts;var y=v-i;if(o){var g=this._videoSegmentInfoList.getLastSegmentBefore(v);null!=g&&g.beginDts<y?(s=y-g.beginDts,y=g.beginDts):o=!1}if(-1===r&&(r=y),o){o=!1,n.unshift(f);var _=this._generateSilentAudio(y,s);if(null==_)continue;var b=_.mp4Sample,S=_.unit;h.push(b),u+=S.byteLength,(l=new Uint8Array(u))[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(wr.types.mdat,4),l.set(S,c),c+=S.byteLength}else{var k=0;k=n.length>=1?n[0].dts-this._dtsBase-i-y:h.length>=1?h[h.length-1].duration:this._audioMeta.refSampleDuration;var w={dts:y,pts:y,cts:0,size:d.byteLength,duration:k,originalDts:v,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};h.push(w),l.set(d,c),c+=d.byteLength}}var A=h[h.length-1];a=A.dts+A.duration,this._audioNextDts=a;var x=new Br;x.beginDts=r,x.endDts=a,x.beginPts=r,x.endPts=a,x.originalBeginDts=h[0].originalDts,x.originalEndDts=A.originalDts+A.duration,x.firstSample=new Er(h[0].dts,h[0].pts,h[0].duration,h[0].originalDts,!1),x.lastSample=new Er(A.dts,A.pts,A.duration,A.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(x),t.samples=h,t.sequenceNumber+=t.addcoefficient;var E=wr.moof(t,r);t.samples=[],t.length=0,this._onMediaSegment("audio",{type:"audio",data:this._mergeBoxes(E,l).buffer,sampleCount:h.length,info:x})}}},{key:"_generateSilentAudio",value:function(e,t){console.log(this.TAG,"GenerateSilentAudio: dts = "+e+", duration = "+t);var n=Ar.getSilentFrame(this._audioMeta.channelCount);return null==n?(console.log(this.TAG,"Cannot generate silent aac frame for channelCount = "+this._audioMeta.channelCount),null):{unit:n,mp4Sample:{dts:e,pts:e,cts:0,size:n.byteLength,duration:t,originalDts:e,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}}}},{key:"_remuxVideo",value:function(e){var t=e,n=t.samples,i=void 0,r=-1,a=-1,o=-1,s=-1;if(n&&0!==n.length){var u=8+e.length,l=new Uint8Array(u);l[0]=u>>>24&255,l[1]=u>>>16&255,l[2]=u>>>8&255,l[3]=255&u,l.set(wr.types.mdat,4);for(var c=8,h=[],f=new Br;n.length;){var d=n.shift(),v=d.isKeyframe,p=d.dts-this._dtsBase;if(void 0==i)if(void 0==this._videoNextDts)if(this._videoSegmentInfoList.isEmpty())i=0;else{var m=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=m){var y=p-(m.originalDts+m.duration);y<=3&&(y=0),i=p-(m.dts+m.duration+y)}else i=0}else i=p-this._videoNextDts;var g=p-i,_=d.cts,b=g+_;-1===r&&(r=g,o=b);for(var S=0;d.units.length;){var k=d.units.shift().data;l.set(k,c),c+=k.byteLength,S+=k.byteLength}var w=0;if(w=n.length>=1?n[0].dts-this._dtsBase-i-g:h.length>=1?h[h.length-1].duration:this._videoMeta.refSampleDuration,v){var A=new Er(g,b,w,d.dts,!0);A.fileposition=d.fileposition,f.appendSyncPoint(A)}var x={dts:g,pts:b,cts:_,size:S,isKeyframe:v,duration:w,originalDts:p,flags:{isLeading:0,dependsOn:v?2:1,isDependedOn:v?1:0,hasRedundancy:0,isNonSync:v?0:1}};h.push(x)}var E=h[h.length-1];if(a=E.dts+E.duration,s=E.pts+E.duration,this._videoNextDts=a,f.beginDts=r,f.endDts=a,f.beginPts=o,f.endPts=s,f.originalBeginDts=h[0].originalDts,f.originalEndDts=E.originalDts+E.duration,f.firstSample=new Er(h[0].dts,h[0].pts,h[0].duration,h[0].originalDts,h[0].isKeyframe),f.lastSample=new Er(E.dts,E.pts,E.duration,E.originalDts,E.isKeyframe),this._isLive||this._videoSegmentInfoList.append(f),t.samples=h,t.sequenceNumber+=t.addcoefficient,this._forceFirstIDR){var B=h[0].flags;B.dependsOn=2,B.isNonSync=0}var L=wr.moof(t,r);t.samples=[],t.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(L,l).buffer,sampleCount:h.length,info:f})}}},{key:"_mergeBoxes",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}(),Tr=function(e){function t(e){Qi(this,t);var n=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._config={_isLive:!1},n._config=Object.assign(n._config,e),n.onInitSegment=null,n.onMediaSegment=null,n.onMediaInfo=null,n.seekCallBack=null,n.loadmetadata=!1,n.ftyp_moov=null,n.metaSuccRun=!1,n.metas=[],n.parseChunk=null,n.hasVideo=!1,n.hasAudio=!1,n._error=null,n._pendingResolveSeekPoint=-1,n._tempBaseTime=0,n.setflvBase=n.setflvBasefrist,Sr._onTrackMetadata=n.Metadata.bind(n),Sr._onMediaInfo=n.metaSucc.bind(n),Sr._onDataAvailable=n.onDataAvailable.bind(n),Sr._onError=n.error.bind(n),n.m4mof=new Dr(n._config),n.m4mof.onMediaSegment=n.onMdiaSegment.bind(n),n}return tr(t,Ki),er(t,[{key:"seek",value:function(e){this.setflvBase=this.setflvBasefrist,void 0!=e&&0!=e||(e=0,this._pendingResolveSeekPoint=-1),this._tempBaseTime!=e&&(this._tempBaseTime=e,Sr._timestampBase=e,this.m4mof.seek(e),this.m4mof.insertDiscontinuity(),this._pendingResolveSeekPoint=e)}},{key:"setflvBasefrist",value:function(e,t){var n=0;try{n=kr.setFlv(new Uint8Array(e))}catch(e){this.error(e)}if(kr.arrTag.length>0){this.hasAudio=kr._hasAudio,this.hasVideo=kr._hasVideo,0!=this._tempBaseTime&&this._tempBaseTime==kr.arrTag[0].getTime()&&(Sr._timestampBase=0);try{Sr.moofTag(kr.arrTag)}catch(e){this.error(e)}this.setflvBase=this.setflvBaseUsually}return n}},{key:"setflvBaseUsually",value:function(e,t){var n=0;try{n=kr.setFlv(new Uint8Array(e))}catch(e){this.error(e)}if(kr.arrTag.length>0)try{Sr.moofTag(kr.arrTag)}catch(e){this.error(e)}return n}},{key:"onMdiaSegment",value:function(e,t){if(this.onMediaSegment&&this.onMediaSegment(new Uint8Array(t.data)),-1!=this._pendingResolveSeekPoint&&"video"==e){var n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=-1,this.seekCallBack&&this.seekCallBack(n)}}},{key:"Metadata",value:function(e,t){switch(e){case"video":if(this.metas.push(t),this.m4mof._videoMeta=t,this.hasVideo&&!this.hasAudio)return void this.metaSucc();break;case"audio":if(this.metas.push(t),this.m4mof._audioMeta=t,!this.hasVideo&&this.hasAudio)return void this.metaSucc()}this.hasVideo&&this.hasAudio&&this.metaSuccRun&&this.metas.length>1&&this.metaSucc()}},{key:"metaSucc",value:function(e){this.onMediaInfo&&this.onMediaInfo(e,{hasAudio:this.hasAudio,hasVideo:this.hasVideo}),0!=this.metas.length?(this.ftyp_moov=wr.generateInitSegment(this.metas),this.onInitSegment&&0==this.loadmetadata&&(this.onInitSegment(this.ftyp_moov),this.loadmetadata=!0)):this.metaSuccRun=!0}},{key:"onDataAvailable",value:function(e,t){try{this.m4mof.remux(e,t)}catch(e){this.error(e)}}},{key:"setflv",value:function(e,t){return this.setflvBase(e,t)}},{key:"setflvloc",value:function(e){kr.setFlv(new Uint8Array(e));if(kr.arrTag.length>0)return kr.arrTag}},{key:"error",value:function(e){this._error&&this._error(e)}}]),t}(),Cr=function(e){function t(e){Qi(this,t);var n=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.f2m=new Tr(e),n.f2m._error=n.error,n._onInitSegment=null,n._onMediaSegment=null,n._onMediaInfo=null,n._seekCallBack=null,n}return tr(t,Ki),er(t,[{key:"error",value:function(e){this.emit("error",e.type)}},{key:"seek",value:function(e){this.f2m.seek(e)}},{key:"setflv",value:function(e){return this.f2m.setflv(e,0)}},{key:"setflvloc",value:function(e){return this.f2m.setflvloc(e)}},{key:"onInitSegment",set:function(e){this._onInitSegment=e,this.f2m.onInitSegment=e}},{key:"onMediaSegment",set:function(e){this._onMediaSegment=e,this.f2m.onMediaSegment=e}},{key:"onMediaInfo",set:function(e){this._onMediaInfo=e,this.f2m.onMediaInfo=e}},{key:"seekCallBack",set:function(e){this._seekCallBack=e,this.f2m.seekCallBack=e}}]),t}(),Or=function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config={},i.tag="transmuxer",i.loader=null,i.CPU=null,i.keyframePoint=!1,i.w=null,Object.assign(i.config,n),i.config.webWorker&&(i.w=dr("./transmuxer-worker"),i.w.postMessage({cmd:"init"}),i.w.addEventListener("message",function(e){i.parseCallback(e.data)})),i}return tr(t,Ki),er(t,[{key:"loadSource",value:function(){this.config.webWorker?this.w.postMessage({cmd:"loadSource"}):(this.loader=new ur(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.open())}},{key:"arrivalDataCallback",value:function(e,t,n){return this.CPU||(this.CPU=new Cr,this.CPU.onInitSegment=this.onRemuxerInitSegmentArrival.bind(this),this.CPU.onMediaSegment=this.onRemuxerMediaSegmentArrival.bind(this),this.CPU.onError=this.onCPUError.bind(this),this.CPU.onMediaInfo=this.onMediaInfo.bind(this),this.CPU.on("error",function(e){console.log(e)})),n&&(this.keyframePoint=!0,this.CPU.seek(n)),this.CPU.setflv(e)}},{key:"parseCallback",value:function(e){switch(e.cmd){case"pipeCallback":e.source;break;case"mediaSegmentInit":this.emit("mediaSegmentInit",e.source);break;case"mediaSegment":this.emit("mediaSegment",e.source);break;case"mediainfo":this.emit("mediainfo",e.source)}}},{key:"onDemuxError",value:function(e,t){En.error(this.tag,"DemuxError: type = "+e+", info = "+t),this.emit("DemuxError",e,t)}},{key:"onMediaInfo",value:function(e){this.mediaInfo=e,this.emit("mediaInfo",e)}},{key:"onRemuxerInitSegmentArrival",value:function(e){this.emit("mediaSegmentInit",e)}},{key:"onRemuxerMediaSegmentArrival",value:function(e){this.emit("mediaSegment",e)}},{key:"onCPUError",value:function(e){this.emit("ERROR",e.data)}},{key:"getMediaInfo",value:function(){return this.mediaInfo}},{key:"pause",value:function(){this.loader.pause()}},{key:"resume",value:function(){this.loader.resume()}},{key:"isSeekable",value:function(){return this.mediaInfo.hasKeyframesIndex}},{key:"seek",value:function(e){if(!this.isSeekable())return this.emit("ERROR","这个flv视频不支持seek"),!1;this.loader=new ur(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.seek(e.keyframePoint,!1,e.keyframetime)}},{key:"refresh",value:function(){this.pause(),this.loader=new ur(this.config),this.loader.arrivalDataCallback=this.arrivalDataCallback.bind(this),this.loader.open()}},{key:"destroy",value:function(){this.loader.destroy(),this.loader=null,this.CPU=null}},{key:"getNearlestKeyframe",value:function(e){if(this.mediaInfo&&this.mediaInfo.keyframesIndex){var t=this.mediaInfo.keyframesIndex.times,n=this.mediaInfo.keyframesIndex.filepositions;return function e(i,r){var a=i.length,o=Math.floor(a/2);if(1===a){var s=t.indexOf(i[0]);return{keyframetime:i[0],keyframePoint:n[s]}}if(i[o]>r)return e(i.slice(0,o),r);if(i[o]<r)return e(i.slice(o),r);var u=t.indexOf(i[0]);return{keyframetime:i[0],keyframePoint:n[u]}}(t,e)}return 0}}]),t}(),Mr={isLive:!1,autoPlay:!1,box:"flv",prestrain:30,alwaysSeekKeyframe:!0,lazyLoadMaxDuration:120,lazyLoadRecoverDuration:30,lockInternalProperty:!1,debug:!0,webWorker:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:30,autoCleanupMinBackwardDuration:30};return function(e){function t(e,n){Qi(this,t);var i=nr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="FLV-player",i.video=e,i.box="flv",i.timer=null,i.config=h({},n,Mr),i.requestSetTime=!1,i.bindEvents(),i.attachMedia(),i}return tr(t,Ki),er(t,[{key:"internalPropertyHandle",value:function(){if(Object.getOwnPropertyDescriptor){var e=this,t=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");Object.defineProperty(this.video,"currentTime",{get:function(){return t.get.call(e.video)},set:function(n){if(e.currentTimeLock)return t.set.call(e.video,n);throw new Error("can not set currentTime by youself")}})}}},{key:"bindEvents",value:function(){var e=this;this.video&&this.video.addEventListener("canplay",function(){e.config.isLive&&e.video.play(),e.config.lockInternalProperty&&e.internalPropertyHandle()})}},{key:"attachMedia",value:function(){var e=this;this.mediaSource=new ir(this.video,this.config),this.mediaSource.on("source_open",function(){e.transmuxer.loadSource()}),this.mediaSource.on("bufferFull",function(){e.pauseTransmuxer()}),this.mediaSource.on("mediaInfo",function(t){e.emit("mediaInfo",t)}),this.mediaSource.on("updateend",function(){e.onmseUpdateEnd()})}},{key:"load",value:function(e){var t=this;e&&(this.config.src=e),this.video.src=URL.createObjectURL(this.mediaSource.mediaSource),this.video.addEventListener("seeking",f(this._seek.bind(this),200,{leading:!1})),this.transmuxer=new Or(this.mediaSource,this.config),this.transmuxer.on("mediaSegment",function(e){t.mediaSource.emit("mediaSegment",e.data)}),this.transmuxer.on("mediaSegmentInit",function(e){t.mediaSource.emit("mediaSegmentInit",e.data)}),this.transmuxer.on("error",function(e){t.emit("error",e.data)})}},{key:"isTimeinBuffered",value:function(e){for(var t=this.video.buffered,n=0;n<t.length;n++){var i=t.start(n),r=t.end(n);if(e>=i&&e<r)return!0}return!1}},{key:"getCurrentBufferEnd",value:function(){for(var e=this.video.buffered,t=this.video.currentTime,n=0;n<e.length;n++){var i=e.start(n),r=e.end(n);if(i<=t&&t<r)return r}}},{key:"_seek",value:function(e){this.currentTimeLock=!0;var t=e&&!isNaN(e)?e:this.video.currentTime;if(this.requestSetTime)return this.requestSetTime=!1,void(this.currentTimeLock=!1);if(this.isTimeinBuffered(t)){if(this.config.alwaysSeekKeyframe){var n=this.transmuxer.getNearlestKeyframe(Math.floor(1e3*t));n&&(this.requestSetTime=!0,this.video.currentTime=n.keyframetime/1e3)}}else{En.verbose(this.tag,"do seek"),this.transmuxer.pause();var i=this.transmuxer.getNearlestKeyframe(Math.floor(1e3*t));t=i.keyframetime/1e3,this.transmuxer.seek(i),this.mediaSource.seek(t),this.requestSetTime=!0,this.video.currentTime=t,window.clearInterval(this.timer),this.timer=null}return this.currentTimeLock=!1,t}},{key:"onmseUpdateEnd",value:function(){var e=this;setTimeout(function(){e.config.isLive||e.getCurrentBufferEnd()>=e.video.currentTime+e.config.lazyLoadMaxDuration&&null===e.timer&&(En.verbose(e.tag,"Maximum buffering duration exceeded, suspend transmuxing task"),e.pauseTransmuxer())},10)}},{key:"heartbeat",value:function(){for(var e=this.video.currentTime,t=this.video.buffered,n=!1,i=0;i<t.length;i++){var r=t.start(i),a=t.end(i);if(e>=r&&e<a){e>=a-this.config.lazyLoadRecoverDuration&&(n=!0);break}}n&&(window.clearInterval(this.timer),this.timer=null,En.verbose(this.tag,"Continue loading from paused position"),this.transmuxer.resume())}},{key:"pauseTransmuxer",value:function(){this.transmuxer.pause(),this.timer||(this.timer=setInterval(this.heartbeat.bind(this),1e3))}},{key:"resume",value:function(){}},{key:"destroy",value:function(){this.video&&(this.video.src="",this.video.removeAttribute("src"),this.transmuxer.destroy(),this.transmuxer=null,this.mediaSource.destroy(),this.mediaSource=null)}},{key:"seek",value:function(e){return this._seek(e)}},{key:"play",value:function(){return this.video.play()}},{key:"pause",value:function(){return this.video.pause()}},{key:"refresh",value:function(){this.transmuxer.refresh()}}]),t}()});
